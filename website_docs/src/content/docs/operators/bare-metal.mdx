---
title: "Bare Metal Reference"
description: "Operator reference for running FrameWorks on bare metal servers."
sidebar:
  order: 7
---

import { Aside } from '@astrojs/starlight/components';

<Aside type="caution" title="Experimental Feature">
Self-hosting and the FrameWorks CLI are currently in **active testing**. APIs and configuration formats may change. Proceed with caution for production environments.
</Aside>

This page is an **operator reference** for those who have deployed FrameWorks via the CLI and need to understand what's running, debug issues, or customize their setup.

For deployment instructions, see:
- [CLI Reference](/operators/cli-reference) - Automated deployment
- [Cluster Manifest](/operators/cluster-manifest) - Configuration format

## Directory Structure

The CLI creates this standard layout on each server:

```
/opt/frameworks/
├── bin/              # Service binaries
├── config/           # Configuration files
├── data/             # Persistent data (recordings, caches)
└── logs/             # Service logs (if not using journald)

/etc/frameworks/
├── quartermaster.env
├── commodore.env
├── purser.env
└── ...               # Per-service environment files
```

Create the structure manually:

```bash
sudo mkdir -p /opt/frameworks/{bin,config,data,logs}
sudo mkdir -p /etc/frameworks
sudo useradd -r -s /sbin/nologin frameworks 2>/dev/null || true
sudo chown -R frameworks:frameworks /opt/frameworks /etc/frameworks
```

## Secrets Generation

These secrets **must be identical across all services**. Generate them once and reuse everywhere.

```bash
# JWT secret (64 hex chars) - for user authentication
openssl rand -hex 32  # → JWT_SECRET

# Password reset secret (32 hex chars) - for email reset tokens
openssl rand -hex 16  # → PASSWORD_RESET_SECRET

# Service token (64 hex chars) - for inter-service auth
openssl rand -hex 32  # → SERVICE_TOKEN
```

Store these securely. Every service that handles auth needs the same `JWT_SECRET`. Every service that communicates internally needs the same `SERVICE_TOKEN`.

## Service Startup Order

Services must start in dependency order. The CLI handles this automatically, but for manual control:

```
Tier 0 (no service dependencies):
┌──────────────┐  ┌────────┐  ┌────────────────┐  ┌─────────┐
│ Quartermaster│  │ Purser │  │ Periscope Query│  │ Decklog │
└──────┬───────┘  └───┬────┘  └────────────────┘  └────┬────┘
       │              │                                │
       └──────┬───────┘                                │
              ▼                                        │
Tier 1:  ┌───────────┐                                 │
         │ Commodore │ ← needs Quartermaster + Purser  │
         └─────┬─────┘                                 │
               │                                       │
               └───────────────┬───────────────────────┘
                               ▼
Tier 2:                   ┌─────────┐
                          │ Foghorn │ ← needs Commodore + Quartermaster + Decklog
                          └────┬────┘
                               │
                               ▼
Tier 3:                   ┌─────────┐
                          │ Bridge  │ ← needs Commodore + Purser + Quartermaster + Periscope
                          └─────────┘

Regional (per-region):
    Signalman (no inter-service dependencies)

Edge (per-node):
    Helmsman (depends on Foghorn + Decklog)
```

## Health Check Reference

All services expose HTTP health endpoints on `/health`. For the complete list of service ports, see [Architecture Overview](/operators/architecture#core-services).

**Quick health check:**

```bash
# Central services
for port in 18002 18001 18003 18004 18008 18000; do
    curl -sf http://localhost:$port/health && echo " :$port OK" || echo " :$port FAIL"
done

# gRPC health (requires grpcurl)
grpcurl -plaintext localhost:19002 grpc.health.v1.Health/Check
```

## Firewall Configuration

Minimum required ports:

```bash
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw allow 80/tcp       # HTTP
sudo ufw allow 443/tcp      # HTTPS
sudo ufw allow 1935/tcp     # RTMP ingest
sudo ufw allow 51820/udp    # WireGuard
sudo ufw enable
```

**Internal mesh ports** (allow from WireGuard subnet only):

```bash
# Allow all traffic on WireGuard interface
sudo ufw allow in on wg0
```

## Performance Tuning

The CLI applies these automatically with `frameworks edge tune --write`. For manual application:

**Network tuning** (`/etc/sysctl.d/99-frameworks.conf`):

```bash
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
net.core.somaxconn = 8192
net.ipv4.ip_local_port_range = 16384 65535
```

**File descriptors** (`/etc/security/limits.d/frameworks.conf`):

```
* soft nofile 65536
* hard nofile 65536
```

Apply changes:

```bash
sudo sysctl -p /etc/sysctl.d/99-frameworks.conf
# Reboot or re-login for limits changes
```

## Troubleshooting

**Service won't start:**

```bash
# Check status and logs
sudo systemctl status quartermaster
sudo journalctl -u quartermaster -f --no-pager -n 100

# Check if port is in use
sudo ss -tlnp | grep 18002
```

**Database connection issues:**

```bash
# Test PostgreSQL connectivity
psql -h 10.10.0.11 -p 5433 -U frameworks_user -d frameworks -c "SELECT 1;"

# Test ClickHouse
clickhouse-client -h 10.10.0.11 -q "SELECT 1;"
```

**Inter-service communication:**

```bash
# Test gRPC from Bridge to Quartermaster
grpcurl -plaintext localhost:19002 grpc.health.v1.Health/Check

# Check if WireGuard is up
wg show
ping 10.10.0.1  # Central node
```

---

<details>
<summary><strong>Advanced: Manual Database Installation</strong></summary>

For airgapped environments or custom setups where the CLI cannot install dependencies.

### System Dependencies

```bash
sudo apt update && sudo apt upgrade -y
sudo apt install -y build-essential curl wget git unzip

# Go 1.21+
wget https://go.dev/dl/go1.21.0.linux-amd64.tar.gz
sudo tar -C /usr/local -xzf go1.21.0.linux-amd64.tar.gz
echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc

# Node.js 18+ (for frontends)
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# Docker (useful for some components)
curl -fsSL https://get.docker.com | sudo sh
```

### PostgreSQL

```bash
sudo apt install -y postgresql-15 postgresql-client-15
sudo -u postgres createuser --superuser frameworks_user
sudo -u postgres createdb frameworks
sudo -u postgres psql -c "ALTER USER frameworks_user PASSWORD 'your-password';"
```

Initialize schemas:
```bash
# Schemas are in pkg/database/sql/schema/*.sql
sudo -u postgres psql frameworks < pkg/database/sql/schema/quartermaster.sql
sudo -u postgres psql frameworks < pkg/database/sql/schema/commodore.sql
sudo -u postgres psql frameworks < pkg/database/sql/schema/purser.sql
sudo -u postgres psql frameworks < pkg/database/sql/schema/foghorn.sql
sudo -u postgres psql frameworks < pkg/database/sql/schema/periscope.sql
sudo -u postgres psql frameworks < pkg/database/sql/schema/navigator.sql

# Seed billing tiers (required)
sudo -u postgres psql frameworks < pkg/database/sql/seeds/static/purser_tiers.sql
```

### ClickHouse

```bash
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 8919F6BD2B48D754
echo "deb https://packages.clickhouse.com/deb stable main" | sudo tee /etc/apt/sources.list.d/clickhouse.list
sudo apt update && sudo apt install -y clickhouse-server clickhouse-client

sudo systemctl enable clickhouse-server
sudo systemctl start clickhouse-server

# Initialize schema
clickhouse-client < pkg/database/sql/clickhouse/periscope.sql
```

### Kafka

```bash
# Install Java
sudo apt install -y openjdk-11-jdk

# Download Kafka
cd /opt
sudo wget https://downloads.apache.org/kafka/3.6.0/kafka_2.13-3.6.0.tgz
sudo tar -xzf kafka_2.13-3.6.0.tgz
sudo mv kafka_2.13-3.6.0 kafka

# Start Kafka (KRaft mode, single-node)
/opt/kafka/bin/kafka-storage.sh format -t $(cat /proc/sys/kernel/random/uuid) -c /opt/kafka/config/kraft/server.properties
/opt/kafka/bin/kafka-server-start.sh -daemon /opt/kafka/config/kraft/server.properties

# Create required topics
kafka-topics.sh --bootstrap-server localhost:9092 --create \
  --topic analytics_events --partitions 6 --replication-factor 1

kafka-topics.sh --bootstrap-server localhost:9092 --create \
  --topic billing.usage_reports --partitions 3 --replication-factor 1
```

### Building Services

```bash
git clone https://github.com/Livepeer-FrameWorks/monorepo.git
cd monorepo

# Build all binaries
make build

# Or individually
make build-bin-quartermaster
make build-bin-commodore
# etc.
```

Binaries are output to `bin/`.

### Creating systemd Units

Example for Quartermaster:

```bash
sudo tee /etc/systemd/system/quartermaster.service > /dev/null <<'EOF'
[Unit]
Description=FrameWorks Quartermaster
After=network.target postgresql.service
Requires=postgresql.service

[Service]
Type=simple
User=frameworks
WorkingDirectory=/opt/frameworks
EnvironmentFile=/etc/frameworks/quartermaster.env
ExecStart=/opt/frameworks/bin/quartermaster
Restart=always
RestartSec=10
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
EOF

sudo systemctl daemon-reload
sudo systemctl enable quartermaster
sudo systemctl start quartermaster
```

Repeat for each service. The CLI's `frameworks services plan` generates these automatically.

</details>

## Next Steps

- [WireGuard Mesh](/operators/wireguard) - Secure internal networking
- [Topology](/operators/topology) - Multi-region deployment patterns
- [CLI Reference](/operators/cli-reference) - Full command documentation
