---
title: "Cluster Manifest Reference"
description: "Specification for FrameWorks cluster manifest YAML files."
sidebar:
  order: 4
---

import { Aside } from '@astrojs/starlight/components';

The cluster manifest is the blueprint for your FrameWorks deployment. It's a YAML file that tells the CLI exactly how to provision your infrastructure, services, and interfaces.

<Aside type="tip">
FrameWorks uses a GitOps-friendly approach. We recommend committing your `cluster.yaml` to a private repository to track changes to your infrastructure over time.
</Aside>

## File Structure

```yaml
type: central              # Cluster type
profile: production        # Deployment profile
hosts: {}                  # Host definitions
infrastructure: {}         # Infrastructure components
services: {}               # Application services
interfaces: {}             # User-facing interfaces
```

## Top-Level Fields

### type

Defines the deployment mode.

**Values:**
- `cluster` - Full infrastructure cluster (used for both Central and Regional tiers).
- `edge` - Single edge node deployment.

**Example:**
```yaml
type: cluster
```

---

### profile

Deployment environment identifier.

**Values:**
- `production`
- `staging`
- `development`

**Example:**
```yaml
profile: production
```

---

### hosts

Map of host definitions for SSH access.

**Format:**
```yaml
hosts:
  <hostname>:
    address: <ip-or-hostname>
    user: <ssh-user>
    ssh_key: <path-to-private-key>
```

**Example:**
```yaml
hosts:
  central-01:
    address: 10.0.1.10
    user: admin
    ssh_key: ~/.ssh/id_ed25519

  central-02:
    address: 10.0.1.11
    user: admin
    ssh_key: ~/.ssh/id_ed25519

  regional-eu-01:
    address: 10.1.1.10
    user: admin
    ssh_key: ~/.ssh/id_ed25519
```

**Fields:**
- `address` (required) - IP address or hostname
- `user` (required) - SSH username
- `ssh_key` (required) - Path to SSH private key

---

## Infrastructure Section

Database and messaging infrastructure.

> **Version Reference:** See `config/infrastructure.yaml` in the monorepo for tested and recommended versions of all infrastructure components.

### postgres

PostgreSQL or YugabyteDB configuration.

**Format:**
```yaml
infrastructure:
  postgres:
    enabled: true
    host: central-01
    port: 5432
    version: "15.2"
```

**Fields:**
- `enabled` (required) - Enable Postgres
- `host` (required) - Host name from `hosts` section
- `port` (required) - Database port
- `version` (optional) - PostgreSQL version

**Example (YugabyteDB Cluster):**
```yaml
infrastructure:
  postgres:
    enabled: true
    host: central-01
    port: 5433
    version: "2.19"
    cluster:
      enabled: true
      nodes:
        - central-01
        - central-02
        - central-03
      replication_factor: 3
```

---

### clickhouse

ClickHouse analytics database.

**Format:**
```yaml
infrastructure:
  clickhouse:
    enabled: true
    host: central-01
    port: 9000
    version: "23.8"
```

**Fields:**
- `enabled` (required) - Enable ClickHouse
- `host` (required) - Host name
- `port` (required) - Native protocol port (9000)
- `version` (optional) - ClickHouse version

---

### kafka

Apache Kafka message broker.

**Format:**
```yaml
infrastructure:
  kafka:
    enabled: true
    brokers:
      - id: 1
        host: central-01
        port: 9092
      - id: 2
        host: central-02
        port: 9092
```

**Fields:**
- `enabled` (required) - Enable Kafka
- `brokers` (required) - List of broker configurations
  - `id` - Broker ID
  - `host` - Host name
  - `port` - Kafka port (usually 9092)

---

### zookeeper

Zookeeper ensemble for Kafka coordination.

**Format:**
```yaml
infrastructure:
  zookeeper:
    enabled: true
    ensemble:
      - id: 1
        host: central-01
        port: 2181
      - id: 2
        host: central-02
        port: 2181
      - id: 3
        host: central-03
        port: 2181
```

**Fields:**
- `enabled` (required) - Enable Zookeeper
- `ensemble` (required) - List of Zookeeper nodes
  - `id` - Server ID
  - `host` - Host name
  - `port` - Client port (usually 2181)

---

## Services Section

Application services.

### Service Definition

**Format:**
```yaml
services:
  <service-name>:
    enabled: true
    host: <hostname>        # Single instance
    # OR
    hosts:                  # Multiple instances
      - <hostname1>
      - <hostname2>
    port: <port>
    version: <version>
    environment:
      KEY: value
```

**Fields:**
- `enabled` (required) - Enable service
- `host` (optional) - Single host for deployment
- `hosts` (optional) - Multiple hosts for distributed deployment
- `port` (required) - Service port
- `version` (optional) - Version to deploy
- `environment` (optional) - Environment variables

**Example Services:**
```yaml
services:
  commodore:
    enabled: true
    host: central-01
    port: 18001
    environment:
      POSTGRES_HOST: postgres
      KAFKA_BROKERS: kafka:9092

  signalman:
    enabled: true
    hosts:
      - regional-eu-01
      - regional-us-01
    port: 18009
    environment:
      REDIS_URL: redis://redis:6379

  decklog:
    enabled: true
    host: regional-eu-01
    port: 18006
    environment:
      KAFKA_BROKERS: kafka:9092
```

---

### Standard Services

**Central/Regional Services:**
- `bridge` - GraphQL gateway (port 18000)
- `commodore` - Control plane API (port 18001)
- `quartermaster` - Tenant management (port 18002)
- `purser` - Billing service (port 18003)
- `periscope-query` - Analytics query API (port 18004)
- `periscope-ingest` - Analytics ingestion (port 18005)
- `decklog` - Event ingestion (port 18006)
- `foghorn` - Load balancer (port 18008, gRPC control 18019)
- `signalman` - WebSocket gateway (port 18009)
- `navigator` - DNS management (port 18010)

**Edge Services:**
- `helmsman` - MistServer sidecar (port 18007)
- `mistserver` - Media server (port 8080, 1935 for RTMP)

---

## Interfaces Section

User-facing interfaces.

**Format:**
```yaml
interfaces:
  nginx:
    enabled: true
    host: central-01
    port: 80
    tls: true
    cert_path: /etc/ssl/certs/fullchain.pem
    key_path: /etc/ssl/private/privkey.pem

  webapp:
    enabled: true
    host: central-01
    port: 18030

  website:
    enabled: true
    host: central-01
    port: 18031

  forms:
    enabled: true
    host: central-01
    port: 18032
```

**Standard Interfaces:**
- `nginx` - Reverse proxy (port 80/443)
- `webapp` - Application frontend (port 18030)
- `website` - Marketing site (port 18031)
- `website_docs` - Documentation site (port 18033)
- `forms` - Forms service (port 18032)

**Support Services:**
- `prometheus` - Metrics collection (port 9091)
- `grafana` - Metrics visualization (port 3000)
- `listmonk` - Newsletter/mailing list manager (port 9001)

---

## Complete Example

### Central Tier Example

```yaml
type: cluster
profile: production

hosts:
  central-01:
    address: 10.0.1.10
    user: admin
    ssh_key: ~/.ssh/frameworks_ed25519

  central-02:
    address: 10.0.1.11
    user: admin
    ssh_key: ~/.ssh/frameworks_ed25519

  central-03:
    address: 10.0.1.12
    user: admin
    ssh_key: ~/.ssh/frameworks_ed25519

infrastructure:
  postgres:
    enabled: true
    host: central-01
    port: 5433
    cluster:
      enabled: true
      nodes:
        - central-01
        - central-02
        - central-03
      replication_factor: 3

  clickhouse:
    enabled: true
    host: central-01
    port: 9000

  kafka:
    enabled: true
    brokers:
      - id: 1
        host: central-01
        port: 9092
      - id: 2
        host: central-02
        port: 9092

  zookeeper:
    enabled: true
    ensemble:
      - id: 1
        host: central-01
        port: 2181
      - id: 2
        host: central-02
        port: 2181
      - id: 3
        host: central-03
        port: 2181

services:
  bridge:
    enabled: true
    host: central-01
    port: 18000

  commodore:
    enabled: true
    host: central-01
    port: 18001

  quartermaster:
    enabled: true
    host: central-01
    port: 18002

  purser:
    enabled: true
    host: central-01
    port: 18003

  periscope-query:
    enabled: true
    host: central-01
    port: 18004

  periscope-ingest:
    enabled: true
    host: central-01
    port: 18005

interfaces:
  nginx:
    enabled: true
    host: central-01
    port: 80

  webapp:
    enabled: true
    host: central-01
    port: 18030
```

### Regional Tier Example

```yaml
type: cluster
profile: production

hosts:
  regional-eu-01:
    address: 10.1.1.10
    user: admin
    ssh_key: ~/.ssh/frameworks_ed25519

infrastructure:
  kafka:
    enabled: true
    brokers:
      - id: 1
        host: regional-eu-01
        port: 9092

services:
  decklog:
    enabled: true
    host: regional-eu-01
    port: 18006

  foghorn:
    enabled: true
    host: regional-eu-01
    port: 18008

  signalman:
    enabled: true
    host: regional-eu-01
    port: 18009
```

### Edge Tier Example

```yaml
type: edge
profile: production

hosts:
  edge-eu-01:
    address: 10.2.1.10
    user: admin
    ssh_key: ~/.ssh/frameworks_ed25519

services:
  mistserver:
    enabled: true
    host: edge-eu-01
    port: 8080
    environment:
      RTMP_PORT: 1935
```

---

## Validation

Use `detect` to check current state against your manifest:

```bash
# Detect current state against manifest
frameworks cluster detect --manifest cluster.yaml
```

Common validation errors:
- Missing required fields (`enabled`, `host`, `port`)
- Invalid host references (host not in `hosts` section)
- Port conflicts (same port on same host)
- SSH connectivity issues
