---
title: "Cluster Manifest Reference"
description: "Specification for FrameWorks cluster manifest YAML files."
sidebar:
  order: 4
---

import { Aside } from "@astrojs/starlight/components";

The cluster manifest is the blueprint for your FrameWorks deployment. It's a YAML file that tells the CLI how to provision infrastructure, services, and interfaces.

<Aside type="tip">
  FrameWorks uses a GitOps-friendly approach. We recommend committing your `cluster.yaml` to a
  private repository to track changes over time.
</Aside>

## File Structure

```yaml
version: v1
type: cluster
profile: production
hosts: {}
wireguard: {}
infrastructure: {}
services: {}
interfaces: {}
observability: {}
```

## Top-Level Fields

### version

Manifest schema version (required).

**Example:**

```yaml
version: v1
```

---

### type

Cluster manifest type (required).

**Values:**

- `cluster` - Full multi-service deployment.
- `edge` - Single edge node deployment (use `edges.yaml` for multi-node edge fleets; see below).

**Example:**

```yaml
type: cluster
```

---

### profile

Environment/profile name. This is used to form the default cluster ID during provisioning (`{type}-{profile}`), so choose a stable slug (e.g., `production`, `eu-1`).

**Common values:** `development`, `staging`, `production`.

**Example:**

```yaml
profile: production
```

---

### hosts

Map of host definitions for SSH access.

**Format:**

```yaml
hosts:
  <hostname>:
    address: <ip-or-hostname>
    external_ip: <public-ip> # optional
    user: <ssh-user>
    ssh_key: <path-to-private-key> # optional
    roles: [infrastructure, services] # optional
    labels: # optional
      environment: prod
```

**Fields:**

- `address` (required) - IP address or hostname
- `external_ip` (optional) - Public IP used for DNS registration
- `user` (required) - SSH username
- `ssh_key` (optional) - Path to SSH private key
- `roles` (optional) - Arbitrary tags used for human grouping
- `labels` (optional) - Free-form metadata

---

### wireguard

WireGuard mesh configuration for backend infrastructure nodes. Managed by Privateer (`api_mesh`).

**Format:**

```yaml
wireguard:
  enabled: true
  interface: wg0
  manage_hosts_file: true
  peers:
    - name: central-01
      public_key: <pubkey>
      endpoint: 1.2.3.4:51820
      allowed_ips: ["10.18.0.10/32"]
```

**Fields:**

- `enabled` (required)
- `interface` (optional, default `wg0`)
- `manage_hosts_file` (optional) - Write WireGuard hostnames into `/etc/hosts`
- `peers` (optional) - Static peers (manual mesh only)
  > Edge nodes do not join the mesh.

---

## Infrastructure Section

Database and messaging infrastructure.

> **Version Reference:** See `config/infrastructure.yaml` in the monorepo for tested/recommended versions.

### postgres

PostgreSQL or YugabyteDB configuration.

**Format:**

```yaml
infrastructure:
  postgres:
    enabled: true
    mode: native
    version: "15.14"
    host: central-01
    port: 5432
    databases:
      - name: quartermaster
        owner: quartermaster_user
```

**Fields:**

- `enabled` (required)
- `mode` (required) - `native`
- `version` (required)
- `host` (required) - Host name from `hosts`
- `port` (required)
- `databases` (optional)
- `tuning` (optional) - key/value overrides for server tuning

---

### clickhouse

ClickHouse analytics database.

**Format:**

```yaml
infrastructure:
  clickhouse:
    enabled: true
    mode: native
    version: "25.9.2.1"
    host: central-01
    port: 9000
    databases: [periscope]
```

**Fields:**

- `enabled` (required)
- `mode` (required) - `native`
- `version` (required)
- `host` (required)
- `port` (required)
- `databases` (optional)

---

### kafka

Apache Kafka message broker.

**Format:**

```yaml
infrastructure:
  kafka:
    enabled: true
    mode: native
    version: "7.4.0"
    brokers:
      - host: central-01
        id: 1
        port: 9092
    zookeeper_connect: central-01:2181
    topics:
      - name: analytics_events
        partitions: 10
        replication_factor: 3
```

**Fields:**

- `enabled` (required)
- `mode` (required) - `native`
- `version` (required)
- `brokers` (required)
- `zookeeper_connect` (required)
- `topics` (optional)

---

### zookeeper

Zookeeper ensemble (Kafka coordination).

**Format:**

```yaml
infrastructure:
  zookeeper:
    enabled: true
    mode: native
    version: "7.4.0"
    ensemble:
      - host: central-01
        id: 1
        port: 2181
```

**Fields:**

- `enabled` (required)
- `mode` (required) - `native`
- `version` (required)
- `ensemble` (required)

---

## Services / Interfaces / Observability

All three sections share the same shape. Use them to define application services, public interfaces (reverse proxy + web surfaces), and observability stack (Prometheus, Grafana, etc.).

### Service Definition

**Format:**

```yaml
services:
  commodore:
    enabled: true
    mode: docker
    version: v0.0.1
    image: livepeerframeworks/frameworks-commodore:latest
    host: central-01
    port: 18001
    grpc_port: 19001
    env_file: /etc/frameworks/commodore.env
    depends_on: [postgres, kafka]
    config:
      EXAMPLE_KEY: value
```

**Fields:**

- `enabled` (required)
- `mode` (required) - `docker` or `native`
- `version` (required)
- `image` (optional) - Docker image (docker mode)
- `binary_url` (optional) - Binary download URL (native mode)
- `deploy` (optional) - Override deploy slug (container/binary name)
- `host` (optional) - Single host
- `hosts` (optional) - Multiple hosts for replicas
- `replicas` (optional) - Replica count
- `port` (optional)
- `grpc_port` (optional)
- `env_file` (optional)
- `depends_on` (optional)
- `config` (optional) - Service-specific settings

---

## Edge Manifest (edges.yaml)

For multi-node edge fleets, use a dedicated **edge manifest** (`edges.yaml`).

**Format:**

```yaml
version: v1
root_domain: example.com
pool_domain: edge.example.com
email: ops@example.com
cluster_id: regional-production
fetch_cert: true
nodes:
  - name: edge-us-east-1
    ssh: admin@203.0.113.10
    ssh_key: ~/.ssh/id_ed25519
    subdomain: edge-us-east-1
    region: us-east
    apply_tune: true
    register_qm: true
```

**Fields:**

- `root_domain` or `pool_domain` (at least one required)
- `email` (ACME)
- `cluster_id` (required when `register_qm: true`)
- `fetch_cert` (optional) - Fetch certs from Navigator
- `nodes` (required)

**Node fields:**

- `name` (required)
- `ssh` (required) - `user@host`
- `ssh_key` (optional)
- `subdomain` (optional)
- `region` (optional)
- `apply_tune` (optional)
- `register_qm` (optional)
- `labels` (optional)

---

## Validation Notes

The CLI validates:

- Required fields (`version`, `type`, hosts)
- Host references used by infrastructure/services/interfaces

Unknown keys are ignored by the parser, but itâ€™s best to keep manifests minimal and aligned with the schema above.
