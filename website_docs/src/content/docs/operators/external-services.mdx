---
title: "External Services"
description: "Configuration guide for external services: Cloudflare, SSL, SMTP, and Payments."
sidebar:
  order: 9
---

FrameWorks automates much of the heavy lifting for external integrations. While the platform manages the complexity, you'll need to provide the credentials and API keys for these services to function.

## Setting Up DNS

**Purpose:** Domain management, geographic routing, load balancing

**Required Provider:** Cloudflare (API support required for Navigator automation; _self-hosted Anycast planned_)

**Managed By:** Navigator (`api_dns`) - automates DNS record management based on node inventory

**What You Need:**

- Cloudflare account
- API token with permissions for DNS record management
- Domain added to Cloudflare
  - Required permissions: **Zone.DNS (Edit)** and **Account.Load Balancers (Edit)** (for multi-node)

**What Navigator Automates:**

- DNS record creation/updates based on Quartermaster node inventory
- Smart routing: single node → A record, multiple nodes → load balancer pool
- Pool and origin management
- Geographic routing via Cloudflare load balancers
- Removes origins that are no longer in inventory

Navigator skips changes if no nodes are returned for a service type to avoid wiping DNS during transient outages.

**Manual Steps:**

1. Create Cloudflare account
2. Add your domain to Cloudflare
3. Generate API token
4. Set environment variables:
   ```bash
   export CLOUDFLARE_API_TOKEN="your-token"
   export CLOUDFLARE_ZONE_ID="your-zone-id"
   export CLOUDFLARE_ACCOUNT_ID="your-account-id"
   ```
5. Set your root domain:
   ```bash
   export NAVIGATOR_ROOT_DOMAIN="example.com"
   export BRAND_DOMAIN="example.com"
   ```

**Future:** Self-hosted anycast DNS cluster (planned, requires ASN acquisition)

---

## SSL/TLS Certificates

**Purpose:** HTTPS for public endpoints and platform-managed subdomains

**Managed By:** Navigator (`api_dns`) - handles ACME certificate issuance and renewal

**What Navigator Automates:**

- Certificate issuance via ACME (Let's Encrypt) with DNS-01 validation
- Automatic renewal (monitors expiration, renews when < 30 days remaining)
- Certificate caching in PostgreSQL
- Background renewal worker

**Required Setup:** Navigator still needs Cloudflare credentials plus an allowed domain suffix list (`NAVIGATOR_CERT_ALLOWED_SUFFIXES`) or `NAVIGATOR_ROOT_DOMAIN`. In dev, the allowlist can be left empty to allow all.

**Alternative Options:**

- **Caddy** (automatic HTTPS) - for simpler deployments
- **nginx + certbot** (Let's Encrypt) - for manual management

---

## GeoIP Database

**Purpose:** IP geolocation for geographic routing and analytics

**Provider:** MaxMind (GeoLite2 or GeoIP2), DB-IP Lite, or IP2Location LITE

**What You Need:**

- Provider account (as required)
- MMDB file

**What the platform uses:**

- A local MMDB file on Foghorn nodes for geo-aware routing
- Optional IP header enrichment if you already run geo-aware proxies

**Manual Steps:**

1. Download a City/Country MMDB file from your provider
2. Place it on Foghorn hosts and set:
   ```bash
   export GEOIP_MMDB_PATH="/var/lib/GeoIP/GeoLite2-City.mmdb"
   ```

**Usage:** Foghorn uses GeoIP for intelligent routing decisions. If no MMDB is configured, GeoIP is disabled.

---

## Configuring SMTP

**Purpose:** Notifications, alerts, transactional emails

**Providers:** Fastmail, SendGrid, AWS SES, or any SMTP provider

**What You Need:**

- SMTP credentials (host, port, username, password)
- Verified sender domain (for production)

**What's Automated:**

- Service-specific email templates and dispatch logic

**Manual Steps:**

1. Choose email provider
2. Generate SMTP credentials or app password
3. Set environment variables:
   ```bash
   export SMTP_HOST="smtp.provider.com"
   export SMTP_PORT="587"
   export SMTP_USER="your-username"
   export SMTP_PASSWORD="your-password"
   export FROM_EMAIL="noreply@yourdomain.com"
   export FROM_NAME="FrameWorks" # optional
   export TO_EMAIL="ops@yourdomain.com" # Forms API inbox
   ```

**Used By:**

- Forms API (contact form submissions)
- Billing (invoice/payment notifications)
- Auth (email verification + password resets)

**Notes:**

- Billing/Auth email flows skip sending if SMTP is not configured (warnings are logged).
- Forms API requires SMTP + `TO_EMAIL`; otherwise contact submissions will fail.

---

## Enabling Payments

**Purpose:** Billing, subscriptions, payment handling

**Providers:** Stripe (primary), Mollie (optional)

**What You Need:**

- Stripe account and secret key (`STRIPE_SECRET_KEY`)
- Stripe webhook signing secret (`STRIPE_WEBHOOK_SECRET`)
- (Optional) Mollie API key (`MOLLIE_API_KEY`)

**What's Automated:**

- Webhook event handling
- Subscription management
- Payment processing

**Manual Steps:**

1. Create Stripe account at https://stripe.com
2. Get API keys from dashboard
3. Configure webhook endpoint: `https://yourdomain.com/webhooks/billing/stripe`
4. (Optional) If using Mollie, configure: `https://yourdomain.com/webhooks/billing/mollie`
5. Set environment variables:
   ```bash
   export STRIPE_SECRET_KEY="sk_live_..."
   export STRIPE_WEBHOOK_SECRET="whsec_..."
   export MOLLIE_API_KEY="live_xxx" # optional
   ```

**Used By:** Purser (billing API)

**Optional:** Not required for basic platform operation

**Dev only:** If `STRIPE_WEBHOOK_SECRET` is not set, Stripe webhooks are rejected unless `ALLOW_INSECURE_WEBHOOKS=true` (not safe for production).

---

## Summary

| Service  | Provider                      | Required    | Automated by                 |
| -------- | ----------------------------- | ----------- | ---------------------------- |
| DNS      | Cloudflare (recommended)      | Yes         | Navigator (api_dns)          |
| SSL/TLS  | Let's Encrypt (ACME)          | Yes         | Navigator (api_dns)          |
| GeoIP    | MaxMind / DB-IP / IP2Location | Recommended | Operator-managed (MMDB file) |
| SMTP     | Any provider                  | Optional    | Platform (email delivery)    |
| Payments | Stripe, Mollie                | Optional    | Purser (webhook handling)    |

---

## Environment Variables

Complete list of required environment variables:

```bash
# DNS (Required - used by Navigator)
export CLOUDFLARE_API_TOKEN="your-cloudflare-token"
export CLOUDFLARE_ZONE_ID="your-zone-id"
export CLOUDFLARE_ACCOUNT_ID="your-account-id"
export NAVIGATOR_ROOT_DOMAIN="example.com"
export BRAND_DOMAIN="example.com"

# Navigator DNS / cert behavior (optional)
export NAVIGATOR_PROXY_SERVICES="app,website,docs"
export NAVIGATOR_CERT_ALLOWED_SUFFIXES="example.com"
export ACME_ENV="production"

# GeoIP (Recommended)
export GEOIP_MMDB_PATH="/var/lib/GeoIP/GeoLite2-City.mmdb"

# Email (Optional for billing/auth; required for Forms)
export SMTP_HOST="smtp.provider.com"
export SMTP_PORT="587"
export SMTP_USER="username"
export SMTP_PASSWORD="password"
export FROM_EMAIL="noreply@yourdomain.com"
export FROM_NAME="FrameWorks"
export TO_EMAIL="ops@yourdomain.com"

# Stripe (Optional - only if using billing)
export STRIPE_SECRET_KEY="sk_live_..."
export STRIPE_WEBHOOK_SECRET="whsec_..."
export ALLOW_INSECURE_WEBHOOKS="false" # dev-only: set true to bypass signature checks

# Mollie (Optional)
export MOLLIE_API_KEY="live_xxx"
```

Store these securely using:

- Environment files (`.env`)
- Secrets manager (production)
- CI/CD secrets (automated deployments)

---

## Next Steps

1. Set up required external services (DNS, SSL automated)
2. Configure optional services as needed (Email, GeoIP, Payments)
3. Set environment variables
4. Verify CLI can access external APIs
5. Proceed with cluster provisioning

For DNS operations, see [DNS Automation](/operators/dns)
