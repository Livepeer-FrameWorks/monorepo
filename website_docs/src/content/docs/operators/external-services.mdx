---
title: "External Services"
description: "Configuration guide for external services: Cloudflare, SSL, SMTP, and Payments."
sidebar:
  order: 9
---

External service credentials required by the platform.

## Setting Up DNS

**Purpose:** Domain management, geographic routing, load balancing

**Required Provider:** Cloudflare (API support required for Navigator automation; _self-hosted Anycast planned_)

**Managed By:** Navigator (`api_dns`) - automates DNS record management based on node inventory

**What You Need:**

- Cloudflare account
- API token with permissions for DNS record management
- Domain added to Cloudflare
  - Required permissions: **Zone.DNS (Edit)** and **Account.Load Balancers (Edit)** (for multi-node)

Navigator automates DNS record management based on inventory. See [DNS Automation](/operators/dns) for details.

**Manual Steps:**

1. Create Cloudflare account
2. Add your domain to Cloudflare
3. Generate API token
4. Set environment variables:
   ```bash
   export CLOUDFLARE_API_TOKEN="your-token"
   export CLOUDFLARE_ZONE_ID="your-zone-id"
   export CLOUDFLARE_ACCOUNT_ID="your-account-id"
   ```
5. Set your root domain:
   ```bash
   export NAVIGATOR_ROOT_DOMAIN="example.com"
   export BRAND_DOMAIN="example.com"
   ```

**Future:** Self-hosted anycast DNS cluster (planned, requires ASN acquisition)

---

## SSL/TLS Certificates

**Purpose:** HTTPS for public endpoints and platform-managed subdomains

**Managed By:** Navigator (`api_dns`) - handles ACME certificate issuance and renewal

Navigator handles ACME certificate issuance and renewal via DNS-01. See [DNS Automation](/operators/dns) for details.

**Required Setup:** Navigator needs Cloudflare credentials plus `NAVIGATOR_CERT_ALLOWED_SUFFIXES` or `NAVIGATOR_ROOT_DOMAIN`. In dev, the allowlist can be left empty.

**Alternative Options:**

- **Caddy** (automatic HTTPS) - for simpler deployments
- **nginx + certbot** (Let's Encrypt) - for manual management

---

## GeoIP Database

**Purpose:** IP geolocation for geographic routing and analytics

**Provider:** MaxMind (GeoLite2 or GeoIP2), DB-IP Lite, or IP2Location LITE

**What You Need:**

- Provider account (as required)
- MMDB file

**What the platform uses:**

- A local MMDB file on Foghorn nodes for geo-aware routing
- Optional IP header enrichment if you already run geo-aware proxies

**Manual Steps:**

1. Download a City/Country MMDB file from your provider
2. Place it on Foghorn hosts and set:
   ```bash
   export GEOIP_MMDB_PATH="/var/lib/GeoIP/GeoLite2-City.mmdb"
   ```

**Usage:** Foghorn uses GeoIP for intelligent routing decisions. If no MMDB is configured, GeoIP is disabled.

---

## Configuring SMTP

**Purpose:** Notifications, alerts, transactional emails

**Providers:** Fastmail, SendGrid, AWS SES, or any SMTP provider

**What You Need:**

- SMTP credentials (host, port, username, password)
- Verified sender domain (for production)

**What's Automated:**

- Service-specific email templates and dispatch logic

**Manual Steps:**

1. Choose email provider
2. Generate SMTP credentials or app password
3. Set environment variables:
   ```bash
   export SMTP_HOST="smtp.provider.com"
   export SMTP_PORT="587"
   export SMTP_USER="your-username"
   export SMTP_PASSWORD="your-password"
   export FROM_EMAIL="noreply@yourdomain.com"
   export FROM_NAME="FrameWorks" # optional
   export TO_EMAIL="ops@yourdomain.com" # Forms API inbox
   ```

**Used By:**

- Forms API (contact form submissions)
- Billing (invoice/payment notifications)
- Auth (email verification + password resets)

**Notes:**

- Billing/Auth email flows skip sending if SMTP is not configured (warnings are logged).
- Forms API requires SMTP + `TO_EMAIL`; otherwise contact submissions will fail.

---

## Enabling Payments

**Purpose:** Billing, subscriptions, payment handling

**Providers:** Stripe (primary), Mollie (optional)

**What You Need:**

- Stripe account and secret key (`STRIPE_SECRET_KEY`)
- Stripe webhook signing secret (`STRIPE_WEBHOOK_SECRET`)
- (Optional) Mollie API key (`MOLLIE_API_KEY`)

**What's Automated:**

- Webhook event handling
- Subscription management
- Payment processing

**Manual Steps:**

1. Create Stripe account at https://stripe.com
2. Get API keys from dashboard
3. Configure webhook endpoint: `https://yourdomain.com/webhooks/billing/stripe`
4. (Optional) If using Mollie, configure: `https://yourdomain.com/webhooks/billing/mollie`
5. Set environment variables:
   ```bash
   export STRIPE_SECRET_KEY="sk_live_..."
   export STRIPE_WEBHOOK_SECRET="whsec_..."
   export MOLLIE_API_KEY="live_xxx" # optional
   export MOLLIE_WEBHOOK_SECRET="mollie_secret" # optional
   ```

**Used By:** Purser (billing API)

**Optional:** Not required for basic platform operation

**Note:** Stripe webhooks require `STRIPE_WEBHOOK_SECRET` in all environments.

---

## Summary

| Service  | Provider                      | Required    | Automated by                 |
| -------- | ----------------------------- | ----------- | ---------------------------- |
| DNS      | Cloudflare (recommended)      | Yes         | Navigator (api_dns)          |
| SSL/TLS  | Let's Encrypt (ACME)          | Yes         | Navigator (api_dns)          |
| GeoIP    | MaxMind / DB-IP / IP2Location | Recommended | Operator-managed (MMDB file) |
| SMTP     | Any provider                  | Optional    | Platform (email delivery)    |
| Payments | Stripe, Mollie                | Optional    | Purser (webhook handling)    |
