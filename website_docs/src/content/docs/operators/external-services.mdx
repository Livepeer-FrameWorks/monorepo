---
title: "External Services"
description: "Configuration guide for external services: Cloudflare, SSL, SMTP, and Payments."
sidebar:
  order: 9
---

External service credentials required by the platform.

## Setting Up DNS

**Purpose:** Domain management, geographic routing, load balancing

**Required Provider:** Cloudflare (API support required for Navigator automation; _self-hosted Anycast planned_)

**Managed By:** Navigator (`api_dns`) - automates DNS record management based on node inventory

**What You Need:**

- Cloudflare account
- API token with permissions for DNS record management
- Domain added to Cloudflare
  - Required permissions: **Zone.DNS (Edit)** and **Account.Load Balancers (Edit)** (for multi-node)

Navigator automates DNS record management based on inventory. See [DNS Automation](/operators/dns) for details.

**Manual Steps:**

1. Create Cloudflare account
2. Add your domain to Cloudflare
3. Generate API token
4. Set environment variables:
   ```bash
   export CLOUDFLARE_API_TOKEN="your-token"
   export CLOUDFLARE_ZONE_ID="your-zone-id"
   export CLOUDFLARE_ACCOUNT_ID="your-account-id"
   ```
5. Set your root domain:
   ```bash
   export NAVIGATOR_ROOT_DOMAIN="example.com"
   export BRAND_DOMAIN="example.com"
   ```

**Future:** Self-hosted anycast DNS cluster (planned, requires ASN acquisition)

---

## SSL/TLS Certificates

**Purpose:** HTTPS for public endpoints and platform-managed subdomains

**Managed By:** Navigator (`api_dns`) - handles ACME certificate issuance and renewal

Navigator handles ACME certificate issuance and renewal via DNS-01. See [DNS Automation](/operators/dns) for details.

**Required Setup:** Navigator needs Cloudflare credentials plus `NAVIGATOR_CERT_ALLOWED_SUFFIXES` or `NAVIGATOR_ROOT_DOMAIN`. In dev, the allowlist can be left empty.

**Alternative Options:**

- **Caddy** (automatic HTTPS) - for simpler deployments
- **nginx + certbot** (Let's Encrypt) - for manual management

---

## GeoIP Database

**Purpose:** IP geolocation for geographic routing, node placement, and analytics

**Provider:** MaxMind (GeoLite2 or GeoIP2), DB-IP Lite, or IP2Location LITE

**What You Need:**

- Provider account (MaxMind requires a free license key for GeoLite2)
- MMDB file provisioned to target hosts

**Consumed By:**

- **Foghorn** (`api_balancing`) — geo-aware viewer routing decisions
- **Quartermaster** (`api_tenants`) — geolocates nodes at bootstrap for federation map placement

If no MMDB is configured, GeoIP is disabled and services fall back to non-geographic behavior.

**CLI Provisioning (recommended):**

```bash
# Download from MaxMind and distribute to all Foghorn + Quartermaster hosts
frameworks cluster sync-geoip --license-key YOUR_MAXMIND_KEY

# Use a local MMDB file instead
frameworks cluster sync-geoip --source file --file /path/to/GeoLite2-City.mmdb

# Target specific services, restart after upload
frameworks cluster sync-geoip --license-key KEY --services foghorn,quartermaster --restart
```

The CLI reads your cluster manifest to find hosts by role, uploads the MMDB via SSH, and optionally restarts the target containers.

**Manual Provisioning:**

1. Download a City-level MMDB file from your provider
2. Place it on each Foghorn and Quartermaster host at `/var/lib/GeoIP/GeoLite2-City.mmdb`
3. Set environment variables on the target services:
   ```bash
   GEOIP_MMDB_PATH="/var/lib/GeoIP/GeoLite2-City.mmdb"
   ```

**Cache Tuning (optional):**

The shared `pkg/geoip` reader caches lookups. Defaults are sensible for most deployments:

```bash
GEOIP_CACHE_TTL=3600       # Positive cache TTL in seconds (default: 1h)
GEOIP_CACHE_SWR=300        # Stale-while-revalidate window in seconds
GEOIP_CACHE_NEG_TTL=600    # Negative (miss) cache TTL in seconds
GEOIP_CACHE_MAX=10000      # Max cached entries
```

---

## Configuring SMTP

**Purpose:** Notifications, alerts, transactional emails

**Providers:** Fastmail, SendGrid, AWS SES, or any SMTP provider

**What You Need:**

- SMTP credentials (host, port, username, password)
- Verified sender domain (for production)

**What's Automated:**

- Service-specific email templates and dispatch logic

**Manual Steps:**

1. Choose email provider
2. Generate SMTP credentials or app password
3. Set environment variables:
   ```bash
   export SMTP_HOST="smtp.provider.com"
   export SMTP_PORT="587"
   export SMTP_USER="your-username"
   export SMTP_PASSWORD="your-password"
   export FROM_EMAIL="noreply@yourdomain.com"
   export FROM_NAME="FrameWorks" # optional
   export TO_EMAIL="ops@yourdomain.com" # Forms API inbox
   ```

**Used By:**

- Forms API (contact form submissions)
- Billing (invoice/payment notifications)
- Auth (email verification + password resets)

**Notes:**

- Billing/Auth email flows skip sending if SMTP is not configured (warnings are logged).
- Forms API requires SMTP + `TO_EMAIL`; otherwise contact submissions will fail.

---

## Enabling Payments

**Purpose:** Billing, subscriptions, payment handling

**Providers:** Stripe (primary), Mollie (optional)

**What You Need:**

- Stripe account and secret key (`STRIPE_SECRET_KEY`)
- Stripe webhook signing secret (`STRIPE_WEBHOOK_SECRET`)
- (Optional) Mollie API key (`MOLLIE_API_KEY`)

**What's Automated:**

- Webhook event handling
- Subscription management
- Payment processing

**Manual Steps:**

1. Create Stripe account at https://stripe.com
2. Get API keys from dashboard
3. Configure webhook endpoint: `https://yourdomain.com/webhooks/billing/stripe`
4. (Optional) If using Mollie, configure: `https://yourdomain.com/webhooks/billing/mollie`
5. Set environment variables:
   ```bash
   export STRIPE_SECRET_KEY="sk_live_..."
   export STRIPE_WEBHOOK_SECRET="whsec_..."
   export MOLLIE_API_KEY="live_xxx" # optional
   export MOLLIE_WEBHOOK_SECRET="mollie_secret" # optional
   ```

**Used By:** Purser (billing API)

**Optional:** Not required for basic platform operation

**Note:** Stripe webhooks require `STRIPE_WEBHOOK_SECRET` in all environments.

---

## Summary

| Service  | Provider                      | Required    | Automated by               |
| -------- | ----------------------------- | ----------- | -------------------------- |
| DNS      | Cloudflare (recommended)      | Yes         | Navigator (api_dns)        |
| SSL/TLS  | Let's Encrypt (ACME)          | Yes         | Navigator (api_dns)        |
| GeoIP    | MaxMind / DB-IP / IP2Location | Recommended | CLI (`cluster sync-geoip`) |
| SMTP     | Any provider                  | Optional    | Platform (email delivery)  |
| Payments | Stripe, Mollie                | Optional    | Purser (webhook handling)  |
