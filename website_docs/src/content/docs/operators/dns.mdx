---
title: "DNS Automation"
description: "Automated DNS management and certificate issuance with Navigator."
sidebar:
  order: 10
---

import { Aside } from "@astrojs/starlight/components";

Navigator automates DNS record management and certificate issuance for your infrastructure.

---

## DNS Architecture

FrameWorks uses a two-layer routing strategy:

- **DNS layer (Cloudflare)**: Infrastructure-level geo-routing to nearest region
- **Application layer (Foghorn)**: Capacity-aware routing to optimal edge node

> **Note**: Cloudflare is the current DNS provider for convenience, but Navigator is designed to move to a fully self-hosted Anycast DNS layer in the future.

### How Navigator Works

Navigator (`api_dns`) automatically manages Cloudflare DNS based on node inventory from Quartermaster:

1. Quartermaster triggers a DNS sync (for example, when nodes are created/registered)
2. Navigator fetches nodes for that service type and filters to those with external IPs
3. Updates Cloudflare DNS:
   - Single node → A record
   - Multiple nodes → Load balancer pool with geo-steering
4. Applies proxying rules (default: app, website, docs)
5. Handles ACME certificate issuance via DNS-01 challenges

If no nodes are returned for a service type, Navigator skips changes to avoid removing working DNS during a transient outage.

### Verifying DNS State

Use the CLI to verify public DNS matches your inventory:

```bash
frameworks dns doctor --domain yourdomain.com
```

This checks:

- Each subdomain resolves to expected IPs from inventory
- Reports mismatches between public DNS and Quartermaster

By default, the CLI assumes `frameworks.network` if `--domain` is not provided.

---

## Recommended DNS Structure

### Public Endpoints (GeoDNS)

| Subdomain            | Purpose          | Service            |
| -------------------- | ---------------- | ------------------ |
| `example.com`        | Marketing site   | Foredeck (Website) |
| `app.example.com`    | Web console      | Chartroom (Webapp) |
| `api.example.com`    | GraphQL API      | Bridge             |
| `play.example.com`   | Viewer routing   | Foghorn            |
| `ingest.example.com` | Stream ingest    | Edge nodes         |
| `edge.example.com`   | Edge pool domain | Edge nodes         |
| `docs.example.com`   | Docs site        | Logbook (Docs)     |
| `forms.example.com`  | Forms API        | Steward (Forms)    |

Navigator only manages subdomains for service types that exist in Quartermaster inventory. If you want separate `ingest` or `play` domains, register nodes with those types; otherwise use the `edge` pool.

### Internal Services (Private Network / Mesh)

These services communicate over the private network or WireGuard mesh (Privateer) and do **not** need public DNS.
Edge nodes do **not** join the mesh.

- Commodore, Purser, Periscope, Quartermaster, Signalman
- PostgreSQL, ClickHouse, Kafka, Zookeeper

Configure via environment variables with private/mesh IPs:

```bash
export COMMODORE_URL=http://10.0.1.10:18001
export PURSER_URL=http://10.0.1.11:18003
```

### Tenant Subdomains

Tenant-specific subdomains CNAME to the shared infrastructure:

```
tenant1.example.com         → CNAME → play.example.com (or edge.example.com)
tenant1.ingest.example.com  → CNAME → ingest.example.com
```

---

## Cloudflare Configuration

Navigator requires a Cloudflare API token with these permissions:

- **Zone.DNS**: Edit
- **Account.Load Balancers**: Edit (for multi-node setups)

Environment variables for Navigator:

```bash
CLOUDFLARE_API_TOKEN="your-api-token"
CLOUDFLARE_ZONE_ID="your-zone-id"
CLOUDFLARE_ACCOUNT_ID="your-account-id"
```

Optional environment variables:

```bash
# Cloudflare proxy defaults (comma-separated service types)
NAVIGATOR_PROXY_SERVICES="app,website,docs"

# Certificate issuance
ACME_ENV="production"              # or "staging"
NAVIGATOR_CERT_ALLOWED_SUFFIXES="example.com"
```
