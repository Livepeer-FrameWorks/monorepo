---
title: "Running Edge Nodes"
description: "Set up MistServer and Helmsman on your own hardware."
draft: true
sidebar:
  order: 2
---

An edge node pairs MistServer with Helmsman to connect your hardware to the FrameWorks control plane.

## Get the CLI

```bash
# Download
curl -L %GITHUB_URL%/releases/latest/download/frameworks -o frameworks
chmod +x frameworks
sudo mv frameworks /usr/local/bin/

# Verify
frameworks version
```

## Run Preflight Checks

```bash
frameworks edge preflight --domain stream.yourdomain.com
```

This checks:

- Docker and Docker Compose installed
- Ports 80/443 available for HTTPS
- DNS resolves (compare to this server's public IP)
- Kernel parameters (sysctl) are sane
- `/dev/shm` is mounted
- File descriptor limits won’t choke under load

Note: if you plan to use direct ingest or non-HTTP protocols, open the MistServer ports you need:

- **1935/tcp** (RTMP ingest)
- **8889/udp** (SRT ingest)
- **5554/tcp** (RTSP)
- **18203/udp** (WebRTC)
- **4200/tcp** (DTSC replication)
- **8080/tcp** (MistServer HTTP)
- **4242/tcp** (Mist controller; keep internal)

## Apply System Tuning

```bash
# Preview what will change
frameworks edge tune

# Apply the changes (requires root)
sudo frameworks edge tune --write
```

This configures:

- TCP buffer sizes and backlog tuning
- Local port range for high connection counts
- File descriptor limits

## Generate the Edge Stack

```bash
frameworks edge init --dir /opt/frameworks-edge \
  --enrollment-token enroll_xxx \
  --foghorn-addr foghorn.example.com:18019 \
  --email ops@yourdomain.com
```

When using `--enrollment-token`, the CLI calls Foghorn's `PreRegisterEdge` RPC to get an assigned domain, node ID, cluster slug, and TLS certificate. You still need `--foghorn-addr` (or have it set in your CLI context) to reach Foghorn. If you already have a domain and don't need auto-assignment, use `--domain` instead:

```bash
frameworks edge init --dir /opt/frameworks-edge \
  --domain stream.yourdomain.com \
  --email ops@yourdomain.com
```

This creates:

- Edge environment file - Environment configuration
- Edge compose file - MistServer, Helmsman, and Caddy
- Caddy config file - Reverse proxy with automatic HTTPS

## Review the Config

The edge environment file contains the required settings:

```bash
NODE_ID=edge-us-sea-1
EDGE_PUBLIC_URL=https://stream.yourdomain.com/view
FOGHORN_URL=https://foghorn.example.com
FOGHORN_CONTROL_ADDR=foghorn.example.com:18019
FOGHORN_HTTP_BASE=https://foghorn.example.com
EDGE_ENROLLMENT_TOKEN=your-enrollment-token
EDGE_DOMAIN=stream.yourdomain.com
ACME_EMAIL=ops@yourdomain.com
```

`NODE_ID` must be stable and unique per node. `EDGE_PUBLIC_URL` should include the `/view` path.

When using `--enrollment-token` with `edge init`, the CLI populates `NODE_ID`, `EDGE_DOMAIN`, and `FOGHORN_CONTROL_ADDR` from the PreRegisterEdge response. It also stages the cluster's wildcard TLS certificate so Caddy starts with valid HTTPS immediately.

Optional Helmsman overrides (add only if needed, in `.edge.env`):

```bash
HELMSMAN_CAP_INGEST=true
HELMSMAN_CAP_EDGE=true
HELMSMAN_CAP_STORAGE=true
HELMSMAN_CAP_PROCESSING=true
HELMSMAN_MAX_TRANSCODES=0
HELMSMAN_STORAGE_LOCAL_PATH=/var/lib/mistserver/recordings
```

## Start the Stack

```bash
frameworks edge enroll --dir /opt/frameworks-edge
```

This starts the containers and enrolls the node if `EDGE_ENROLLMENT_TOKEN` is set.

Check status:

```bash
frameworks edge status --dir /opt/frameworks-edge
```

You should see:

- `mistserver` - Running
- `helmsman` - Running
- `caddy` - Running
- HTTPS - Valid certificate

## What’s Running

### MistServer

The media server. Handles:

- RTMP/SRT/WHIP ingest
- HLS/DASH/WebRTC delivery
- Recording (if enabled)

Web UI: `http://localhost:4242` (internal, not exposed by default). If you proxy it, add auth/IP restrictions so you don’t expose the controller API.

### Helmsman

The sidecar. Does:

- Forwards MistServer triggers to Foghorn for validation/routing
- Collects client and node metrics for Foghorn
- Reports node capacity and storage details

Health check: `curl http://localhost:18007/health`

### Caddy

Reverse proxy. Provides:

- Automatic HTTPS via Let’s Encrypt
- Routes viewer traffic to MistServer
- Terminates TLS

## Logs

```bash
# All containers
frameworks edge logs --dir /opt/frameworks-edge

# Specific container
frameworks edge logs helmsman --dir /opt/frameworks-edge --follow

# Or use docker directly
docker compose -f docker-compose.edge.yml logs -f helmsman
```

## Common Issues

**"DNS does not resolve to this host"**

Your DNS record doesn’t point to this server’s public IP.

```bash
dig +short stream.yourdomain.com
curl ifconfig.me
```

**"Port 443 in use"**

```bash
sudo lsof -i :443
sudo systemctl stop nginx
```

**"Certificate failed"**

```bash
frameworks edge cert --dir /opt/frameworks-edge
frameworks edge cert --dir /opt/frameworks-edge --reload
```

**"Helmsman can't reach Foghorn"**

Network issue or firewall blocking outbound gRPC/HTTPS.

```bash
curl -I $FOGHORN_URL/health
```

## Next Steps

Your edge node is running. Next: [Connect to the network](/hybrid/connecting).
