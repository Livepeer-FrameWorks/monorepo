---
title: "Connecting to the Network"
description: "Enroll your edge node with the FrameWorks control plane."
draft: true
sidebar:
  order: 3
---

Connecting your edge node is the final step in the setup process. Enrollment establishes a secure identity for your node, allowing it to receive traffic and report telemetry to the control plane.

## Get an Enrollment Token

You need a bootstrap token from an admin, or from your tenant's dashboard (owner).

**Via Dashboard (tenant owner):**

1. Go to **Infrastructure → Network**
2. Click **Create Private Cluster**
3. Copy the bootstrap token shown in the modal

**Via CLI (admin):**

```bash
frameworks admin bootstrap-tokens create \
  --kind edge_node \
  --tenant-id <TENANT_UUID> \
  --cluster-id <CLUSTER_ID> \
  --name "edge-node-1" \
  --ttl 24h
```

By default, bootstrap tokens are single-use. Set `--usage-limit` if you need a reusable token.

## Enroll the Node

First, add the enrollment token to your `.edge.env`:

```bash
# In .edge.env
EDGE_ENROLLMENT_TOKEN=your-enrollment-token
```

Then start the stack:

```bash
frameworks edge enroll --dir /opt/frameworks-edge
```

This:

1. Starts the MistServer, Helmsman, and Caddy containers
2. Waits for HTTPS to become available
3. Helmsman connects to Foghorn (gRPC) and sends the enrollment token
4. Foghorn registers the node in Quartermaster and begins routing

The enrollment token carries `tenant_id` and `cluster_id`, so your node is enrolled into the correct cluster automatically. After enrollment, your node appears in the dashboard under **Infrastructure → Network**.

### PreRegisterEdge (Token-Based Provisioning)

If you used `--enrollment-token` during `frameworks edge init`, the CLI called Foghorn's `PreRegisterEdge` RPC before generating templates. This returned:

- **Node ID** — a stable, unique identifier for your node
- **Edge domain** — `edge-{node_id}.{cluster_slug}.{base_domain}` (Navigator creates the A record)
- **Pool domain** — the cluster's shared edge pool domain
- **Foghorn gRPC address** — for Helmsman's ongoing control stream
- **Wildcard TLS certificate** — `*.{cluster_slug}.{base_domain}`, staged locally so Caddy starts with valid HTTPS

The CLI needs `--foghorn-addr` (or a configured CLI context) to reach Foghorn for this call. Edge nodes only communicate with Foghorn — they do not join the internal WireGuard mesh.

### Certificate Renewal (ConfigSeed)

After initial provisioning, certificate renewals are pushed to edge nodes via **ConfigSeed** — Foghorn sends updated TLS bundles to Helmsman over the existing gRPC control stream. Edges do not need direct access to the ACME provider or Navigator.

## Verify Connection

Check that your node is talking to the network:

```bash
frameworks edge status --dir /opt/frameworks-edge
```

This shows:

- **Docker container status** for MistServer, Helmsman, and edge-proxy
- **HTTPS health check** against your configured `EDGE_DOMAIN`

For enrollment and heartbeat status, check the dashboard—your node should appear under **Infrastructure → Network** once enrolled.

## How Traffic Gets Routed

Once enrolled, Foghorn (the load balancer) knows about your node. When a viewer requests a stream:

1. **Foghorn** checks which nodes have the stream
2. **GeoIP** determines the viewer's location
3. **Scoring** weighs node load, viewer proximity, and stream availability
4. **Redirect** sends the viewer to the best node (possibly yours)

Your node will receive traffic when:

- A stream is ingesting to your node
- Viewers are geographically closer to you than other edges
- Other edges are overloaded

## Ingesting to Your Node

Streamers can push directly to your node instead of the default ingest. Direct ingest requires MistServer ports to be exposed on the host; the default edge template only maps 80/443.

Open/forward as needed:

- **1935/tcp** (RTMP ingest)
- **8889/udp** (SRT ingest)
- **5554/tcp** (RTSP)

Caddy listens on 80/443 and proxies HTTP traffic to MistServer on 8080.

Direct RTMP ingest:

```
rtmp://stream.yourdomain.com:1935/live/{stream-key}
```

Or use the network's default ingest and let Foghorn route:

```
%RTMP_URL%/{stream-key}
```

Both work. Direct ingest means lower latency to your node; network ingest means Foghorn picks the best ingest point.

## Capacity and Capabilities

Your node advertises what it can do. Set these in `.edge.env`, and pass them through to the helmsman container (add them to `helmsman.environment` or add `env_file: .edge.env` in `docker-compose.edge.yml`):

```bash
# In .edge.env
HELMSMAN_CAP_INGEST=true    # Can receive RTMP/SRT streams
HELMSMAN_CAP_EDGE=true      # Can serve viewers
HELMSMAN_CAP_STORAGE=true   # Can store recordings
HELMSMAN_CAP_PROCESSING=true # Can transcode
```

Disable capabilities you don't want:

```bash
# Viewer-only node (no ingest)
HELMSMAN_CAP_INGEST=false

# Ingest-only node (no viewers)
HELMSMAN_CAP_EDGE=false
```

## Removing a Node from the Network

To stop receiving network traffic:

```bash
cd /opt/frameworks-edge
docker compose -f docker-compose.edge.yml down
```

When Helmsman stops, Foghorn stops receiving heartbeats. After 90 seconds without heartbeats, the node is marked stale and excluded from routing (the registry entry is retained).

## Troubleshooting Enrollment

**"Invalid token"**

The token was already used or expired. Get a fresh one.

**"Network unreachable"**

Your server can't reach the control plane. Check firewalls, DNS, and outbound HTTPS.

**"Node already enrolled"**

This usually means the node already has an identity. You can just start the stack again—no re‑enrollment required. If you need to move the node to a different cluster, revoke the old token, create a new one, and enroll again.

**Node shows offline in dashboard**

Helmsman isn't sending heartbeats.

```bash
# Check Helmsman logs
frameworks edge logs helmsman --tail 50
```

## Next Steps

Your node is connected. Learn how to [manage it day-to-day](/hybrid/node-cli).
