# RFC: Vault Secrets Management

## Status

Draft

## TL;DR

- Replace production `.env` secrets with Vault-backed retrieval.
- Keep local dev on env files.
- Provide optional cached secrets for Vault outages.

## Current State (as of 2026-01-13)

- Secrets are loaded from environment variables generated by `make env`.
- No Vault client or Vault provisioning exists in the repo.

Evidence:

- `pkg/config/env.go`
- `config/env/`

## Problem / Motivation

Plain-text env files are not suitable for production secrets management and complicate rotation. Vault provides centralized secret storage with access control and audit trails.

## Goals

- Centralized secrets for production.
- Local dev unchanged.
- Graceful fallback when Vault is unavailable.

## Non-Goals

- Full Vault automation or policy management in this RFC.
- Edge-node Vault access (edge should remain env-only).

## Proposal

- Add a Vault client in `pkg/config` with AppRole auth + caching.
- Services read secrets through `GetSecret()`; env is fallback if Vault not configured.
- CLI provisioner injects Vault AppRole creds for central/regional services.

## Impact / Dependencies

- `pkg/config` changes.
- CLI provisioning (`cli/`)
- Deployment docs updates.

## Alternatives Considered

- Vault Agent sidecar (more ops complexity).
- Continue env-only (status quo).

## Risks & Mitigations

- Risk: Vault outage at startup. Mitigation: cached secrets.
- Risk: migration errors. Mitigation: phased rollout per service.

## Migration / Rollout

1. Add Vault client + caching layer.
2. Integrate one service as pilot.
3. Expand to central/regional services.
4. Update deployment docs.

## Open Questions

- Where should Vault live in the deployment topology?
- What is the minimum set of secrets to migrate first?

## References, Sources & Evidence

- `pkg/config/env.go`
- `config/env/`
- `website_docs/src/content/docs/operators/deployment-manual.mdx`
