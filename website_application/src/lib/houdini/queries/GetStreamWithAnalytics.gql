# Fetch stream with analytics summary, viewer time-series, and quality distribution
# Optimized query for analytics dashboard with time-series charts
query GetStreamWithAnalytics(
  $id: ID!
  $timeRange: TimeRangeInput
  $qualityTimeRange: TimeRangeInput
  $interval: String = "5m"
) {
  stream(id: $id) {
    id
    name
    playbackId
    analytics(timeRange: $timeRange) {
      totalViews
      peakViewers
      avgViewers
      uniqueViewers
      totalSessionDuration
      uniqueCountries
      uniqueCities
      avgBufferHealth
      avgBitrate
      packetLossRate
      currentResolution
      currentCodec
      bitrateKbps
      currentFps
      qualityTier
      currentBufferState
      currentIssues
    }
    viewerTimeSeriesConnection(
      timeRange: $timeRange
      interval: $interval
      first: 100
    ) {
      edges {
        node {
          timestamp
          viewerCount
        }
      }
    }
    qualityDailyConnection(timeRange: $qualityTimeRange, first: 7) {
      edges {
        node {
          id
          day
          tier1080pMinutes
          tier720pMinutes
          tier480pMinutes
          tierSdMinutes
          codecH264Minutes
          codecH265Minutes
        }
      }
    }
  }
}
