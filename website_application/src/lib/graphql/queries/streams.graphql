# Stream management queries
# Config fields from Control Plane (Commodore)
fragment StreamConfig on Stream {
  id
  name
  description
  streamKey
  playbackId
  record
  createdAt
  updatedAt
}

# Operational metrics from Data Plane (Periscope) - lazy loaded via edge
fragment StreamMetricsFields on StreamMetrics {
  status
  isLive
  currentViewers
  peakViewers
  totalViews
  startedAt
  endedAt
  duration
  lastEventAt
  lastEventType
}

# Combined fragment for full stream data
fragment StreamInfo on Stream {
  ...StreamConfig
  metrics {
    ...StreamMetricsFields
  }
}

query GetStreams {
  streams {
    ...StreamInfo
  }
}

query GetStreamsConnection($first: Int = 50, $after: String) {
  streamsConnection(first: $first, after: $after) {
    edges {
      cursor
      node {
        ...StreamInfo
      }
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
    totalCount
  }
}

query GetStream($id: ID!) {
  stream(id: $id) {
    ...StreamInfo
  }
}

query ValidateStreamKey($streamKey: String!) {
  validateStreamKey(streamKey: $streamKey) {
    status
    streamKey
    error
  }
}

# Stream keys management queries
fragment StreamKeyInfo on StreamKey {
  id
  streamId
  keyValue
  keyName
  isActive
  lastUsedAt
  createdAt
}

query GetStreamKeys($streamId: ID!) {
  streamKeys(streamId: $streamId) {
    ...StreamKeyInfo
  }
}

# Recordings management queries
fragment DVRRequestInfo on DVRRequest {
  dvrHash
  internalName
  durationSeconds
  sizeBytes
  manifestPath
  startedAt
  endedAt
  status
  createdAt
  updatedAt
}

query GetRecordings($streamId: String) {
  dvrRecordingsConnection(internalName: $streamId) {
    edges {
      node {
        ...DVRRequestInfo
      }
    }
    totalCount
  }
}

query GetRecordingsConnection($streamId: String, $first: Int = 50, $after: String) {
  dvrRecordingsConnection(internalName: $streamId, first: $first, after: $after) {
    edges {
      cursor
      node {
        ...DVRRequestInfo
      }
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
    totalCount
  }
}

query GetStreamRecordings($streamId: String!) {
  dvrRecordingsConnection(internalName: $streamId) {
    edges {
      node {
        ...DVRRequestInfo
      }
    }
  }
}
