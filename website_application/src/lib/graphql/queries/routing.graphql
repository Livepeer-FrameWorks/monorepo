# Routing and connection event queries

# Query for routing events from Helmsman (Connection version)
query GetRoutingEvents(
  $stream: String
  $timeRange: TimeRangeInput
  $first: Int = 100
  $after: String
  $noCache: Boolean = false
) {
  routingEventsConnection(
    stream: $stream
    timeRange: $timeRange
    first: $first
    after: $after
    noCache: $noCache
  ) {
    edges {
      cursor
      node {
        timestamp
        streamName
        selectedNode
        status
        details
        score
        clientCountry
        clientLatitude
        clientLongitude
        clientBucket { h3Index resolution }
        nodeLatitude
        nodeLongitude
        nodeName
        nodeBucket { h3Index resolution }
      }
    }
    pageInfo {
      hasNextPage
      endCursor
    }
    totalCount
  }
}

# Query for connection events (viewer connections/disconnections)
query GetConnectionEvents(
  $stream: String
  $timeRange: TimeRangeInput
  $first: Int = 100
  $after: String
  $noCache: Boolean = false
) {
  connectionEventsConnection(
    stream: $stream
    timeRange: $timeRange
    first: $first
    after: $after
    noCache: $noCache
  ) {
    edges {
      cursor
      node {
        eventId
        timestamp
        internalName
        sessionId
        connectionAddr
        connector
        nodeId
        countryCode
        city
        latitude
        longitude
        clientBucket { h3Index resolution }
        nodeBucket { h3Index resolution }
        eventType
      }
    }
    pageInfo {
      hasNextPage
      endCursor
    }
    totalCount
  }
}

# Query for node performance metrics
query GetNodeMetrics(
  $nodeId: String
  $timeRange: TimeRangeInput
  $first: Int = 100
  $after: String
  $noCache: Boolean = false
) {
  nodeMetricsConnection(
    nodeId: $nodeId
    timeRange: $timeRange
    first: $first
    after: $after
    noCache: $noCache
  ) {
    edges {
      cursor
      node {
        timestamp
        nodeId
        cpuUsage
        memoryTotal
        memoryUsed
        diskTotal
        diskUsed
        shmTotal
        shmUsed
        networkRx
        networkTx
        status
        latitude
        longitude
        tags
        metadata
      }
    }
    pageInfo {
      hasNextPage
      endCursor
    }
    totalCount
  }
}

# Query for all routing events across platform (for admin view)
query GetPlatformRoutingEvents(
  $timeRange: TimeRangeInput
  $first: Int = 100
  $after: String
  $noCache: Boolean = false
) {
  routingEventsConnection(
    timeRange: $timeRange
    first: $first
    after: $after
    noCache: $noCache
  ) {
    edges {
      cursor
      node {
        timestamp
        streamName
        selectedNode
        status
        score
        clientCountry
        clientLatitude
        clientLongitude
        clientBucket { h3Index resolution }
        nodeLatitude
        nodeLongitude
        nodeName
        nodeBucket { h3Index resolution }
        details
      }
    }
    pageInfo {
      hasNextPage
      endCursor
    }
    totalCount
  }
}

# Query for connection patterns by stream
query GetStreamConnectionEvents(
  $stream: String!
  $timeRange: TimeRangeInput
  $first: Int = 100
  $after: String
  $noCache: Boolean = false
) {
  connectionEventsConnection(
    stream: $stream
    timeRange: $timeRange
    first: $first
    after: $after
    noCache: $noCache
  ) {
    edges {
      cursor
      node {
        timestamp
        sessionId
        connectionAddr
        nodeId
        countryCode
        city
        latitude
        longitude
        eventType
      }
    }
    pageInfo {
      hasNextPage
      endCursor
    }
    totalCount
  }
}

# Query for node health across all nodes
query GetAllNodeMetrics(
  $timeRange: TimeRangeInput
  $first: Int = 100
  $after: String
  $noCache: Boolean = false
) {
  nodeMetricsConnection(
    timeRange: $timeRange
    first: $first
    after: $after
    noCache: $noCache
  ) {
    edges {
      cursor
      node {
        timestamp
        nodeId
        cpuUsage
        memoryTotal
        memoryUsed
        diskTotal
        diskUsed
        shmTotal
        shmUsed
        networkRx
        networkTx
        status
        latitude
        longitude
      }
    }
    pageInfo {
      hasNextPage
      endCursor
    }
    totalCount
  }
}
