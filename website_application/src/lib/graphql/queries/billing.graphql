# Billing queries

# Fragments for reusable field selections
fragment UsageSummaryFields on UsageSummary {
  billingMonth
  period
  streamHours
  viewerHours
  egressGb
  recordingGb
  storageGb
  peakBandwidthMbps
  totalStreams
  totalViewers
  peakViewers
  maxViewers
  avgViewers
  uniqueCountries
  uniqueCities
  avgBufferHealth
  avgBitrate
  packetLossRate
}

fragment BillingTierFields on BillingTier {
  id
  name
  description
  basePrice
  currency
  billingPeriod
  features {
    recording
    analytics
    customBranding
    apiAccess
    supportLevel
    sla
  }
  bandwidthAllocation {
    limit
    unitPrice
    unit
  }
  storageAllocation {
    limit
    unitPrice
    unit
  }
  computeAllocation {
    limit
    unitPrice
    unit
  }
  overageRates {
    bandwidth {
      limit
      unitPrice
      unit
    }
    storage {
      limit
      unitPrice
      unit
    }
    compute {
      limit
      unitPrice
      unit
    }
  }
  supportLevel
  slaLevel
  meteringEnabled
  isEnterprise
}

fragment InvoiceFields on Invoice {
  id
  amount
  currency
  status
  dueDate
  createdAt
  lineItems {
    description
    quantity
    unitPrice
    total
  }
}

query GetBillingTiers {
  billingTiers {
    ...BillingTierFields
  }
}

query GetBillingStatus {
  billingStatus {
    currency
    currentTier {
      ...BillingTierFields
    }
    nextBillingDate
    trialEndsAt
    outstandingAmount
    billingStatus
    usageSummary {
      ...UsageSummaryFields
    }
  }
}

query GetTenantUsage($timeRange: TimeRangeInput) {
  tenantUsage(timeRange: $timeRange) {
    billingPeriod
    usage {
      resourceType
      amount
    }
    costs {
      resourceType
      cost
    }
    totalCost
    currency
  }
}

query GetInvoices {
  invoices {
    ...InvoiceFields
  }
}

query GetInvoice($id: ID!) {
  invoice(id: $id) {
    ...InvoiceFields
  }
}
