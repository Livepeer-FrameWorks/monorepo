# Fetch stream overview data for the main stream detail page
# Includes core fields, metrics, analytics, viewer time series, and current health
# Other data (events, sessions, quality) are fetched separately to stay under complexity limit
query GetStreamOverview(
  $id: ID!
  $streamId: ID!
  $timeRange: TimeRangeInput
  $first: Int = 50
  $viewerFirst: Int = 168
  $viewerInterval: String = "1h"
  $qualityFirst: Int = 60
) {
  stream(id: $id) {
    # Core config fields
    ...StreamCoreFields

    # Operational metrics
    metrics {
      ...StreamMetricsFields
    }
  }
  analytics {
    usage {
      streaming {
        streamAnalyticsSummary(streamId: $streamId, timeRange: $timeRange) {
          streamId
          rangeAvgViewers
          rangePeakConcurrentViewers
          rangeTotalViews
          rangeTotalSessions
          rangeUniqueViewers
          rangeUniqueCountries
          rangeViewerHours
          rangeEgressGb
          rangeAvgSessionSeconds
          rangeAvgBytesPerSession
          rangeAvgBufferHealth
          rangeAvgBitrate
          rangeAvgFps
          rangePacketLossRate
          rangeAvgConnectionTime
          rangeRebufferCount
          rangeIssueCount
          rangeBufferDryCount
          rangeQuality {
            tier2160pMinutes
            tier1440pMinutes
            tier1080pMinutes
            tier720pMinutes
            tier480pMinutes
            tierSdMinutes
            codecH264Minutes
            codecH265Minutes
            codecVp9Minutes
            codecAv1Minutes
          }
        }
        # Time-series for viewer/connection trends
        viewerTimeSeriesConnection(
          streamId: $streamId
          timeRange: $timeRange
          interval: $viewerInterval
          page: { first: $viewerFirst }
        ) {
          edges {
            cursor
            node {
              timestamp
              streamId
              viewerCount
            }
          }
          pageInfo {
            ...PageInfoFields
          }
          totalCount
        }
        streamConnectionHourlyConnection(
          streamId: $streamId
          timeRange: $timeRange
          page: { first: $first }
        ) {
          edges {
            cursor
            node {
              hour
              streamId
              totalBytes
              uniqueViewers
              totalSessions
            }
          }
          pageInfo {
            ...PageInfoFields
          }
          totalCount
        }
        qualityTierDailyConnection(
          streamId: $streamId
          timeRange: $timeRange
          page: { first: $qualityFirst }
        ) {
          edges {
            cursor
            node {
              day
              streamId
              tier2160pMinutes
              tier1440pMinutes
              tier1080pMinutes
              tier720pMinutes
              tier480pMinutes
              tierSdMinutes
              codecH264Minutes
              codecH265Minutes
              avgBitrate
              avgFps
            }
          }
          pageInfo {
            ...PageInfoFields
          }
          totalCount
        }
      }
    }
    health {
      streamHealthConnection(streamId: $streamId, timeRange: $timeRange, page: { first: $first }) {
        edges {
          node {
            timestamp
            streamId
            nodeId
            hasIssues
            issuesDescription
            bitrate
            fps
            width
            height
            codec
            qualityTier
            bufferState
            bufferHealth
          }
        }
        pageInfo {
          ...PageInfoFields
        }
      }
    }
  }
}
