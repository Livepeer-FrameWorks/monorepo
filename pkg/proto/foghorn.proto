syntax = "proto3";

package foghorn;

option go_package = "frameworks/pkg/proto";

import "shared.proto";

// =============================================================================
// FOGHORN CONTROL PLANE SERVICES
// These are control-plane operations exposed by Foghorn for Commodore to call.
// Media-plane operations (MistServer control, stream state) remain in ipc.proto.
// =============================================================================

// ClipService handles clip creation and management
service ClipControlService {
  // CreateClip creates a new clip from a stream
  rpc CreateClip(shared.CreateClipRequest) returns (shared.CreateClipResponse);
  // GetClips returns all clips for a tenant
  rpc GetClips(shared.GetClipsRequest) returns (shared.GetClipsResponse);
  // GetClip returns a specific clip by hash
  rpc GetClip(shared.GetClipRequest) returns (shared.ClipInfo);
  // GetClipURLs returns viewing URLs for a clip
  rpc GetClipURLs(shared.GetClipURLsRequest) returns (shared.ClipViewingURLs);
  // DeleteClip deletes a clip
  rpc DeleteClip(shared.DeleteClipRequest) returns (shared.DeleteClipResponse);
}

// DVRControlService handles DVR recording management
service DVRControlService {
  // StartDVR initiates DVR recording for a stream
  rpc StartDVR(shared.StartDVRRequest) returns (shared.StartDVRResponse);
  // StopDVR stops an active DVR recording
  rpc StopDVR(shared.StopDVRRequest) returns (shared.StopDVRResponse);
  // DeleteDVR deletes a DVR recording and its files
  rpc DeleteDVR(shared.DeleteDVRRequest) returns (shared.DeleteDVRResponse);
  // GetDVRStatus returns status of a DVR recording
  rpc GetDVRStatus(shared.GetDVRStatusRequest) returns (shared.DVRInfo);
  // ListDVRRecordings lists all DVR recordings for a tenant
  rpc ListDVRRecordings(shared.ListDVRRecordingsRequest) returns (shared.ListDVRRecordingsResponse);
}

// ViewerControlService handles viewer and ingest endpoint resolution
service ViewerControlService {
  // ResolveViewerEndpoint resolves the best endpoint(s) for a viewer
  rpc ResolveViewerEndpoint(shared.ViewerEndpointRequest) returns (shared.ViewerEndpointResponse);
  // ResolveIngestEndpoint resolves the best endpoint(s) for StreamCrafter ingest
  rpc ResolveIngestEndpoint(shared.IngestEndpointRequest) returns (shared.IngestEndpointResponse);
  // GetStreamMeta returns MistServer JSON meta for a stream
  rpc GetStreamMeta(shared.StreamMetaRequest) returns (shared.StreamMetaResponse);
}

// VodControlService handles VOD upload management (user-initiated video uploads)
service VodControlService {
  // CreateVodUpload initiates a multipart upload and returns presigned URLs
  rpc CreateVodUpload(shared.CreateVodUploadRequest) returns (shared.CreateVodUploadResponse);
  // CompleteVodUpload finalizes the multipart upload after all parts are uploaded
  rpc CompleteVodUpload(shared.CompleteVodUploadRequest) returns (shared.CompleteVodUploadResponse);
  // AbortVodUpload cancels an in-progress multipart upload
  rpc AbortVodUpload(shared.AbortVodUploadRequest) returns (shared.AbortVodUploadResponse);
  // GetVodAsset returns a single VOD asset by hash
  rpc GetVodAsset(shared.GetVodAssetRequest) returns (shared.VodAssetInfo);
  // ListVodAssets returns paginated list of VOD assets for a tenant
  rpc ListVodAssets(shared.ListVodAssetsRequest) returns (shared.ListVodAssetsResponse);
  // DeleteVodAsset deletes a VOD asset
  rpc DeleteVodAsset(shared.DeleteVodAssetRequest) returns (shared.DeleteVodAssetResponse);
}
