# =============================================================================
# FRAMEWORKS BASE CONFIGURATION
# =============================================================================
# Defaults power the local docker-compose stack. Secrets live in secrets.env.
# Update the values below for each deployment environment (staging, prod, etc.).

# === DATABASES ===============================================================

# Postgres application database connection.
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=frameworks
POSTGRES_SSL_MODE=disable

# ClickHouse analytics database connection.
CLICKHOUSE_HOST=clickhouse
CLICKHOUSE_HTTP_PORT=8123
CLICKHOUSE_NATIVE_PORT=9000
CLICKHOUSE_DB=frameworks

# === MESSAGING & STREAMING BUS ===============================================

# Kafka cluster used for analytics and signalling.
KAFKA_HOST=kafka
KAFKA_PORT=9092
KAFKA_CLUSTER_ID=frameworks
KAFKA_TOPICS=analytics_events

# === INTERNAL SERVICE MESH (CLUSTER DNS) =====================================

# These host:port pairs are used for container-to-container calls inside the
# docker compose network. Override the hosts when deploying to Kubernetes or
# a different mesh.
BRIDGE_HOST=bridge
BRIDGE_PORT=18000
COMMODORE_HOST=commodore
COMMODORE_PORT=18001
QUARTERMASTER_HOST=quartermaster
QUARTERMASTER_PORT=18002
PURSER_HOST=purser
PURSER_PORT=18003
PERISCOPE_QUERY_HOST=periscope-query
PERISCOPE_QUERY_PORT=18004
PERISCOPE_INGEST_HOST=periscope-ingest
PERISCOPE_INGEST_PORT=18005
DECKLOG_HOST=decklog
DECKLOG_PORT=18006
HELMSMAN_HOST=helmsman
HELMSMAN_PORT=18007
FOGHORN_HOST=foghorn
FOGHORN_PORT=18008
FOGHORN_CONTROL_PORT=18019
SIGNALMAN_HOST=signalman
SIGNALMAN_PORT=18009
WS_MAX_CONNECTIONS_PER_TENANT=5
API_FORMS_HOST=forms-api
API_FORMS_PORT=18032
MISTSERVER_HOST=mistserver
MISTSERVER_PORT=4242

# === PUBLIC ENDPOINTS (EXTERNAL FACING) ======================================
# NOTE: the bundled nginx config will not work when changing default ports.

# These URLs are embedded into frontends and emails. Always set to the public
# HTTPS endpoints for the deployment.
GATEWAY_PUBLIC_URL=http://localhost:18090/graphql
AUTH_PUBLIC_URL=http://localhost:18090/auth
WEBAPP_PUBLIC_URL=http://localhost:18090/app
MARKETING_PUBLIC_URL=http://localhost:18090/marketing
FORMS_PUBLIC_URL=http://localhost:18032

# Listen ports for internal services (containers + dev servers)
WEBAPP_PORT=18030
WEBSITE_PORT=18031

# === STREAMING INFRASTRUCTURE =================================================

# Producer ingest endpoint (RTMP for now) and viewer delivery endpoint.
STREAMING_INGEST_URL=rtmp://localhost:1935/live
STREAMING_EDGE_URL=http://localhost:18090/view
STREAMING_HLS_PATH=/hls
STREAMING_WEBRTC_PATH=/webrtc
STREAMING_EMBED_PATH=/

# === BRANDING & LINKS ========================================================

BRAND_NAME=FrameWorks
BRAND_DOMAIN=frameworks.network
BRAND_CONTACT_EMAIL=info@frameworks.network
GITHUB_URL=https://github.com/livepeer-frameworks/monorepo
LIVEPEER_URL=https://livepeer.org
LIVEPEER_EXPLORER_URL=https://explorer.livepeer.org
FORUM_URL=https://forum.frameworks.network
DISCORD_URL=https://discord.gg/9J6haUjdAq
DEMO_STREAM_NAME=live+frameworks-demo

# === NODE IDENTIFIERS ========================================================

# Default region tag applied to services (used for metrics/logging).
REGION=development

# === GLOBAL RUNTIME DEFAULTS =================================================

# Adjust for prod deployments (e.g., LOG_LEVEL=warn, GIN_MODE=release).
LOG_LEVEL=info
GIN_MODE=debug
BUILD_ENV=development
NODE_ENV=development

# Forms API CORS allow list (comma separated origins).
FORMS_ALLOWED_ORIGINS=http://localhost,https://frameworks.network

# === EDGE / HELMSMAN / GEOIP (PROD-CRITICAL) =================================

# Publicly reachable hostname for this edge node (e.g., edge1.frameworks.network).
EDGE_PUBLIC_HOSTNAME=localhost

# Enrollment token generated via Quartermaster when registering edge nodes.
EDGE_ENROLLMENT_TOKEN=

# Logical identifiers for this node; used for inventory and analytics.
HELMSMAN_CLUSTER_ID=default-cluster
HELMSMAN_NODE_ID=edge-node-1

# Maximum concurrent transcodes Helmsman will advertise. Leave empty to allow
# automatic sizing via MistServer telemetry.
HELMSMAN_MAX_TRANSCODES=

# Capabilities toggles (set false to disable specific workloads on this node).
HELMSMAN_CAP_INGEST=true
HELMSMAN_CAP_EDGE=true
HELMSMAN_CAP_STORAGE=true
HELMSMAN_CAP_PROCESSING=true

# gRPC security settings for Helmsman control plane connections.
HELMSMAN_GRPC_USE_TLS=false
HELMSMAN_GRPC_TLS_CERT_PATH=
HELMSMAN_GRPC_TLS_KEY_PATH=

# Local / object storage configuration for recorded assets.
HELMSMAN_STORAGE_LOCAL_PATH=/var/lib/mistserver/recordings
HELMSMAN_STORAGE_S3_BUCKET=
HELMSMAN_STORAGE_S3_PREFIX=
HELMSMAN_STORAGE_CAPACITY_BYTES=1099511627776

# GeoIP database path used for geo-aware balancing. Leave empty to disable.
GEOIP_MMDB_PATH=
# Optional cache tuning knobs (advanced).
GEOIP_CACHE_TTL=300s
GEOIP_CACHE_SWR=120s
GEOIP_CACHE_NEG_TTL=60s
GEOIP_CACHE_MAX=50000

# === DECKLOG (EVENT INGEST) ==================================================

# Allow HTTP fallback for local development; set false and configure TLS in prod.
DECKLOG_ALLOW_INSECURE=true
DECKLOG_TLS_CERT_FILE=/etc/letsencrypt/live/decklog/fullchain.pem
DECKLOG_TLS_KEY_FILE=/etc/letsencrypt/live/decklog/privkey.pem
# Prometheus metrics HTTP port exposed by Decklog.
DECKLOG_METRICS_PORT=18026

# === FOGHORN (LOAD BALANCER) =================================================

# Cache windows for Commodore API lookups.
COMMODORE_CACHE_TTL=60s
COMMODORE_CACHE_SWR=30s
COMMODORE_CACHE_NEG_TTL=10s
COMMODORE_CACHE_MAX=10000

# gRPC security knobs. Provide certificate paths when enabling TLS.
FOGHORN_GRPC_USE_TLS=false
FOGHORN_GRPC_TLS_CERT_PATH=
FOGHORN_GRPC_TLS_KEY_PATH=

# Toggle TLS when Foghorn connects to Decklog.
DECKLOG_USE_TLS=false

# Balancing weights used when computing node scores.
CPU_WEIGHT=500
RAM_WEIGHT=500
BANDWIDTH_WEIGHT=1000
GEO_WEIGHT=1000
STREAM_BONUS=50

# Quartermaster client cache sizing (advanced).
QUARTERMASTER_CACHE_TTL_SECONDS=60
QUARTERMASTER_CACHE_SWR_SECONDS=30
QUARTERMASTER_CACHE_NEG_TTL_SECONDS=10
QUARTERMASTER_CACHE_MAX=10000

# === BRIDGE (GRAPHQL GATEWAY) ================================================

# Enable GraphQL Playground UI in non-production environments.
GRAPHQL_PLAYGROUND_ENABLED=true
# Maximum allowed query complexity. Lower this to protect the gateway in prod.
GRAPHQL_COMPLEXITY_LIMIT=200

# === PERISCOPE (ANALYTICS) ===================================================

# Kafka consumer identifiers for ingest workers.
PERISCOPE_INGEST_KAFKA_GROUP_ID=periscope-ingest
PERISCOPE_INGEST_KAFKA_CLIENT_ID=periscope-ingest
# Enables the optional HTTP health server for ingest.
PERISCOPE_INGEST_ENABLE_HEALTH_ENDPOINT=true

# === SIGNALMAN ===============================================================

# Kafka consumer identifiers for realtime websocket hub.
SIGNALMAN_KAFKA_GROUP_ID=signalman-group
SIGNALMAN_KAFKA_CLIENT_ID=signalman
