# =============================================================================
# FRAMEWORKS BASE CONFIGURATION
# =============================================================================
# Defaults power the local docker-compose stack. Secrets live in secrets.env.
# Update the values below for each deployment environment (staging, prod, etc.).

# === DATABASES ===============================================================

# Postgres application database connection.
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=frameworks
POSTGRES_SSL_MODE=disable

# ClickHouse analytics database connection.
CLICKHOUSE_HOST=clickhouse
CLICKHOUSE_HTTP_PORT=8123
CLICKHOUSE_NATIVE_PORT=9000
CLICKHOUSE_DB=periscope

# === MESSAGING & STREAMING BUS ===============================================

# Kafka cluster used for analytics and signalling.
KAFKA_HOST=kafka
KAFKA_PORT=9092
KAFKA_CLUSTER_ID=frameworks
ANALYTICS_KAFKA_TOPIC=analytics_events
SERVICE_EVENTS_KAFKA_TOPIC=service_events
BILLING_KAFKA_TOPIC=billing.usage_reports
DECKLOG_DLQ_KAFKA_TOPIC=decklog_events_dlq

# === INTERNAL SERVICE MESH (CLUSTER DNS) =====================================

# These host:port pairs are used for container-to-container calls inside the
# docker compose network. Override the hosts when deploying to Kubernetes or
# a different mesh.
BRIDGE_HOST=bridge
BRIDGE_PORT=18000
COMMODORE_HOST=commodore
COMMODORE_PORT=18001
QUARTERMASTER_HOST=quartermaster
QUARTERMASTER_PORT=18002
PURSER_HOST=purser
PURSER_PORT=18003
PERISCOPE_QUERY_HOST=periscope-query
PERISCOPE_QUERY_PORT=18004
PERISCOPE_INGEST_HOST=periscope-ingest
PERISCOPE_INGEST_PORT=18005
DECKLOG_HOST=decklog
DECKLOG_PORT=18006
HELMSMAN_HOST=helmsman
HELMSMAN_PORT=18007
FOGHORN_HOST=foghorn
FOGHORN_PORT=18008
FOGHORN_CONTROL_PORT=18019
SIGNALMAN_HOST=signalman
SIGNALMAN_PORT=18009
NAVIGATOR_HOST=navigator
NAVIGATOR_PORT=18010
NAVIGATOR_GRPC_PORT=18011
NAVIGATOR_DNS_TTL_A_RECORD=60
NAVIGATOR_DNS_TTL_LB=60
NAVIGATOR_DNS_HEALTH_STALE_SECONDS=90
NAVIGATOR_DNS_RECONCILE_INTERVAL_SECONDS=60
NAVIGATOR_CF_MONITOR_INTERVAL=60
NAVIGATOR_CF_MONITOR_TIMEOUT=5
NAVIGATOR_CF_MONITOR_RETRIES=2
PRIVATEER_HOST=privateer
PRIVATEER_PORT=18012

# Skipper (AI Video Consultant)
SKIPPER_HOST=skipper
SKIPPER_PORT=18018
SKIPPER_GRPC_PORT=19007
# Embedded web UI at / (set "false" to run headless API-only)
SKIPPER_WEB_UI=true
# Tenant ID for the admin WebUI. When set, Gateway tools operate under this tenant.
# When unset, chat and knowledge search still work but Gateway tools are unavailable.
SKIPPER_ADMIN_TENANT_ID=5eed517e-ba5e-da7a-517e-ba5eda7a0001  # demo tenant, not a secret
# Comma-separated sitemap URLs for automatic crawling (e.g., https://logbook.example.com/sitemap.xml)
SITEMAPS=
# Directory containing sitemap files (one URL per line). Re-read each tick.
SKIPPER_SITEMAPS_DIR=
# How often the knowledge crawler re-checks sitemaps (also used as TTL to skip on boot)
CRAWL_INTERVAL=24h
# Chunk size for document embedding (approximate BPE tokens)
CHUNK_TOKEN_LIMIT=500
CHUNK_TOKEN_OVERLAP=50
# Enable headless browser rendering for JS-heavy pages (Rod auto-downloads Chromium)
SKIPPER_ENABLE_RENDERING=true
# Enable LLM-generated context prepended to chunks before embedding (uses UTILITY_LLM)
SKIPPER_CONTEXTUAL_RETRIEVAL=true
# Discover and crawl same-domain links found on crawled pages
SKIPPER_LINK_DISCOVERY=true
# Enable Hypothetical Document Embeddings for search_knowledge (adds ~500-1500ms latency)
SKIPPER_ENABLE_HYDE=true

DECKHAND_HOST=deckhand
DECKHAND_PORT=18015
DECKHAND_WEBHOOK_RATE_LIMIT_PER_MIN=600
REDIS_ADDR=platform-redis:6379

# Chatwoot (support chat backend)
CHATWOOT_HOST=chatwoot
CHATWOOT_PORT=3000
CHATWOOT_ACCOUNT_ID=1
CHATWOOT_INBOX_ID=1
CHATWOOT_FRONTEND_URL=http://localhost:18090/support

# Control Plane gRPC Ports (internal service-to-service)
COMMODORE_GRPC_PORT=19001
QUARTERMASTER_GRPC_PORT=19002
PURSER_GRPC_PORT=19003
PERISCOPE_QUERY_GRPC_PORT=19004
SIGNALMAN_GRPC_PORT=19005
DECKHAND_GRPC_PORT=19006
NAVIGATOR_ROOT_DOMAIN=frameworks.network
WS_MAX_CONNECTIONS_PER_TENANT=5
API_FORMS_HOST=forms
API_FORMS_PORT=18032
MISTSERVER_HOST=mistserver
MISTSERVER_PORT=4242

# === PUBLIC ENDPOINTS (EXTERNAL FACING) ======================================
# NOTE: the bundled nginx config will not work when changing default ports.

# These URLs are embedded into frontends and emails. Always set to the public
# HTTPS endpoints for the deployment.
# GATEWAY_PUBLIC_URL is the base gateway URL (no endpoint path).
GATEWAY_PUBLIC_URL=http://localhost:18090
AUTH_PUBLIC_URL=http://localhost:18090/auth
WEBAPP_PUBLIC_URL=http://localhost:18090/app
MARKETING_PUBLIC_URL=http://localhost:18090/marketing
DOCS_PUBLIC_URL=http://localhost:18090/docs
API_PUBLIC_URL=http://localhost:18090
FORMS_PUBLIC_URL=http://localhost:18032

# Listen ports for internal services (containers + dev servers)
WEBAPP_PORT=18030
WEBSITE_PORT=18031
WEBSITE_DOCS_PORT=18033

# === STREAMING INFRASTRUCTURE =================================================

# Streaming server URLs - apps parse hostname and use TLS mode from scheme (http vs https)
# For production:
#   STREAMING_INGEST_URL = https://edge-ingest.frameworks.network (geobalanced ingest)
#   STREAMING_PLAY_URL   = https://foghorn.frameworks.network    (Foghorn 307 redirects)
#   STREAMING_EDGE_URL   = https://edge-egress.frameworks.network (GeoDNS direct to edge)

STREAMING_INGEST_URL=http://localhost:8080

# Foghorn load balancer for HTTP protocols (HLS, DASH, MP4, WebRTC) - 307 redirects
STREAMING_PLAY_URL=http://localhost:18008

# Direct edge for non-HTTP protocols (SRT, RTMP, RTSP, DTSC) - GeoDNS
STREAMING_EDGE_URL=http://localhost:18090/view

# Protocol-specific ports (RTMP and SRT need explicit ports, HTTP uses URL port)
STREAMING_RTMP_PORT=1935
STREAMING_SRT_PORT=8889

# URL paths for various streaming protocols
STREAMING_RTMP_PATH=/live
STREAMING_HLS_PATH=/hls
STREAMING_WEBRTC_PATH=/webrtc
STREAMING_EMBED_PATH=/

# === BRANDING & LINKS ========================================================

BRAND_NAME=FrameWorks
BRAND_DOMAIN=frameworks.network
BRAND_CONTACT_EMAIL=info@frameworks.network
GITHUB_URL=https://github.com/livepeer-frameworks/monorepo
LIVEPEER_URL=https://livepeer.org
LIVEPEER_EXPLORER_URL=https://explorer.livepeer.org
FORUM_URL=https://forum.frameworks.network
DISCORD_URL=https://discord.gg/9J6haUjdAq
DEMO_STREAM_NAME=live+frameworks-demo

# === NODE IDENTIFIERS ========================================================

# Default region tag applied to services (used for metrics/logging).
REGION=development

# Cluster ID for service registration with Quartermaster.
# Must match an entry in quartermaster.infrastructure_clusters table.
# Used for multi-cluster routing (Commodore resolves tenant→cluster via
# Quartermaster GetClusterRouting), per-cluster billing attribution
# (cluster_id + origin_cluster_id on ClickHouse events), and federation
# peer discovery. In dev, the seeded cluster is 'central-primary'.
CLUSTER_ID=central-primary

# Foghorn HA: Redis enables cross-instance state sync. Without it, Foghorn
# runs standalone. configgen maps FOGHORN_REDIS_URL → REDIS_URL per process.
FOGHORN_REDIS_URL=redis://foghorn-redis:6379

# Stable identifier for this Foghorn instance. Must be unique per instance and
# persist across restarts — used for Redis state filtering and leader election.
# HA peers override per instance (e.g., foghorn-2 sets FOGHORN_INSTANCE_ID=foghorn-2).
FOGHORN_INSTANCE_ID=foghorn-1

# === GLOBAL RUNTIME DEFAULTS =================================================

# Adjust for prod deployments (e.g., LOG_LEVEL=warn, GIN_MODE=release).
LOG_LEVEL=info
GIN_MODE=debug
BUILD_ENV=development
NODE_ENV=development

# Forms API CORS allow list (comma separated origins).
FORMS_ALLOWED_ORIGINS=http://localhost,https://frameworks.network

WEBHOOK_RATE_LIMIT_PER_MIN=300

# Webhook signing secrets (payment providers).
MOLLIE_WEBHOOK_SECRET=

# Comma-separated CIDRs or IPs for trusted proxies (empty = use direct RemoteAddr only).
TRUSTED_PROXY_CIDRS=

# gRPC service-token metadata policy: allow | audit
GRPC_METADATA_POLICY=allow

# === EDGE / HELMSMAN / GEOIP (PROD-CRITICAL) =================================

# Publicly reachable hostname for this edge node (e.g., edge1.frameworks.network).
EDGE_PUBLIC_URL=http://localhost:18090/view

# Enrollment token generated via Quartermaster when registering edge nodes.
EDGE_ENROLLMENT_TOKEN=

# Logical identifier for this edge node; used for inventory and analytics.
HELMSMAN_NODE_ID=edge-node-1

# Maximum concurrent transcodes Helmsman will advertise. Leave empty to allow
# automatic sizing via MistServer telemetry.
HELMSMAN_MAX_TRANSCODES=

# Capabilities toggles (set false to disable specific workloads on this node).
HELMSMAN_CAP_INGEST=true
HELMSMAN_CAP_EDGE=true
HELMSMAN_CAP_STORAGE=true
HELMSMAN_CAP_PROCESSING=true

# Requested operational mode sent to Foghorn on registration: normal | draining | maintenance.
# Foghorn is authoritative and may override this based on DB-persisted admin settings.
# Selfhosted operators: set to "draining" or "maintenance" to request exclusion from routing.
HELMSMAN_OPERATIONAL_MODE=normal

# Blocking trigger retry tuning (PUSH_REWRITE, USER_NEW).
# Grace period for reconnects before denying a blocking trigger.
HELMSMAN_BLOCKING_GRACE_MS=2000

# === PROCESSING / TRANSCODING ================================================

# Livepeer Gateway URL for H.264 transcoding (optional).
# When configured, Foghorn tells Helmsman to enable MistProcLivepeer.
# H.264 streams route to Gateway; H.265/AV1/VP9 use local MistServer.
LIVEPEER_GATEWAY_URL=

# Optional Helmsman client cert for mutual TLS. Leave empty for server-only TLS.
HELMSMAN_GRPC_TLS_CERT_PATH=
HELMSMAN_GRPC_TLS_KEY_PATH=

# Local / object storage configuration for recorded assets.
HELMSMAN_STORAGE_LOCAL_PATH=/var/lib/mistserver/recordings
HELMSMAN_STORAGE_S3_BUCKET=
HELMSMAN_STORAGE_S3_PREFIX=
HELMSMAN_STORAGE_CAPACITY_BYTES=1099511627776

# Foghorn default storage base when node StorageLocal is unavailable.
# Should match HELMSMAN_STORAGE_LOCAL_PATH for consistent path reconstruction.
# Only needed if running Foghorn separately from nodes or for testing.
FOGHORN_DEFAULT_STORAGE_BASE=

# GeoIP database path used for geo-aware balancing. Leave empty to disable.
GEOIP_MMDB_PATH=
# Optional cache tuning knobs (advanced).
GEOIP_CACHE_TTL=300s
GEOIP_CACHE_SWR=120s
GEOIP_CACHE_NEG_TTL=60s
GEOIP_CACHE_MAX=50000

# === DECKLOG (EVENT INGEST) ==================================================

# Allow HTTP fallback for local development; set false and configure TLS in prod.
DECKLOG_ALLOW_INSECURE=true
# TLS paths follow Let's Encrypt convention: /etc/letsencrypt/live/{fqdn}/
# Example prod values: decklog.frameworks.network or decklog-eu.frameworks.network
DECKLOG_TLS_CERT_FILE=/etc/letsencrypt/live/decklog.frameworks.network/fullchain.pem
DECKLOG_TLS_KEY_FILE=/etc/letsencrypt/live/decklog.frameworks.network/privkey.pem
# Prometheus metrics HTTP port exposed by Decklog.
DECKLOG_METRICS_PORT=18026

# === FOGHORN (LOAD BALANCER) =================================================

# Cache windows for Commodore API lookups.
COMMODORE_CACHE_TTL=60s
COMMODORE_CACHE_SWR=30s
COMMODORE_CACHE_NEG_TTL=10s
COMMODORE_CACHE_MAX=10000

# Optional Foghorn server cert override. When empty, Foghorn auto-provisions
# from Navigator. When set, uses these files instead.
FOGHORN_GRPC_TLS_CERT_PATH=
FOGHORN_GRPC_TLS_KEY_PATH=

# Toggle TLS when Foghorn connects to Decklog.
DECKLOG_USE_TLS=false

# Balancing weights used when computing node scores.
CPU_WEIGHT=500
RAM_WEIGHT=500
BANDWIDTH_WEIGHT=1000
GEO_WEIGHT=1000
STREAM_BONUS=50

# Quartermaster client cache sizing (advanced).
QUARTERMASTER_CACHE_TTL_SECONDS=60
QUARTERMASTER_CACHE_SWR_SECONDS=30
QUARTERMASTER_CACHE_NEG_TTL_SECONDS=10
QUARTERMASTER_CACHE_MAX=10000

# === BRIDGE (GRAPHQL GATEWAY) ================================================

# Enable GraphQL Playground UI in non-production environments.
GRAPHQL_PLAYGROUND_ENABLED=true
# Maximum allowed query complexity. Lower this to protect the gateway in prod.
GRAPHQL_COMPLEXITY_LIMIT=2000

# === PERISCOPE (ANALYTICS) ===================================================

# Kafka consumer identifiers for ingest workers.
PERISCOPE_INGEST_KAFKA_GROUP_ID=periscope-ingest
PERISCOPE_INGEST_KAFKA_CLIENT_ID=periscope-ingest
# Enables the optional HTTP health server for ingest.
PERISCOPE_INGEST_ENABLE_HEALTH_ENDPOINT=true

# === SIGNALMAN ===============================================================

# Kafka consumer identifiers for realtime websocket hub.
SIGNALMAN_KAFKA_GROUP_ID=signalman-group
SIGNALMAN_KAFKA_CLIENT_ID=signalman

# === MAILING LIST (LISTMONK) =================================================

LISTMONK_HOST=listmonk
LISTMONK_PORT=9000
LISTMONK_URL=http://listmonk:9000
DEFAULT_MAILING_LIST_ID=1

# === PURSER (BILLING) ========================================================

# Kafka consumer identifiers for billing workers.
PURSER_KAFKA_GROUP_ID=purser-ingest
PURSER_KAFKA_CLIENT_ID=purser

# Crypto/x402 toggles
CRYPTO_INCLUDE_TESTNETS=false
X402_INCLUDE_TESTNETS=false

# RPC endpoints for crypto/x402 (override as needed)
ETH_RPC_ENDPOINT=https://eth.publicnode.com
BASE_RPC_ENDPOINT=https://base.publicnode.com
ARBITRUM_RPC_ENDPOINT=https://arb1.arbitrum.io/rpc
BASE_SEPOLIA_RPC_ENDPOINT=https://base-sepolia.publicnode.com
ARBITRUM_SEPOLIA_RPC_ENDPOINT=https://sepolia-rollup.arbitrum.io/rpc
